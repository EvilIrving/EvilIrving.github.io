<!DOCTYPE html>
<html lang="zn-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cain | keep in mind</title>
    <meta name="description" content="记录一切的地方">
    <link rel="preload stylesheet" href="/assets/style.f5ae94b1.css" as="style">
    
    <script type="module" src="/assets/app.083fb1b7.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.0d42427e.js">
    <link rel="modulepreload" href="/assets/chunks/theme.5400fed3.js">
    <link rel="modulepreload" href="/assets/front_node_Express 教程丨阿西河.md.4ea0f2bc.lean.js">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-6be51355><!--[--><!--]--><!--[--><span tabindex="-1" data-v-ae3e3f51></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-ae3e3f51> Skip to content </a><!--]--><!----><header class="VPNav" data-v-6be51355 data-v-7e5bc4a5><div class="VPNavBar" data-v-7e5bc4a5 data-v-faa4ef78><div class="container" data-v-faa4ef78><div class="title" data-v-faa4ef78><div class="VPNavBarTitle" data-v-faa4ef78 data-v-8bbac535><a class="title" href="/" data-v-8bbac535><!--[--><!--]--><!--[--><img class="VPImage logo" src="/gezi.svg" alt data-v-6db2186b><!--]--><!--[-->Go home<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-faa4ef78><div class="curtain" data-v-faa4ef78></div><div class="content-body" data-v-faa4ef78><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-faa4ef78><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-faa4ef78 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-764effdf><span class="text" data-v-764effdf><!----> Work <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-764effdf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/front/basic/" data-v-2f2cfafc><!--[-->HTML/CSS/JS/TS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/front/engineering/" data-v-2f2cfafc><!--[-->工程化<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/front/frame/" data-v-2f2cfafc><!--[-->Vue/React<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/front/node/" data-v-2f2cfafc><!--[-->Node<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/tech/otherside/" data-v-2f2cfafc><!--[-->Electron/Other<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/tech/arithmetic/" data-v-2f2cfafc><!--[-->算法<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/tech/designpattern/" data-v-2f2cfafc><!--[-->设计模式<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-764effdf><span class="text" data-v-764effdf><!----> Life <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-764effdf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/library/reading/" data-v-2f2cfafc><!--[-->看看书<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/library/photos/" data-v-2f2cfafc><!--[-->拍照片<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/library/videos/" data-v-2f2cfafc><!--[-->录视频<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-764effdf><span class="text" data-v-764effdf><!----> FindMe <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-764effdf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/about/" data-v-2f2cfafc><!--[-->关于<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-2f2cfafc><a class="VPLink link" href="/about/Todo.html" data-v-2f2cfafc><!--[-->TODO 指向其它<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-faa4ef78 data-v-f6a63727><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-f6a63727 data-v-82b282f1 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-82b282f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-82b282f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-faa4ef78 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/EvilIrving" aria-label="cool link" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="http://yomuki.com/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-faa4ef78 data-v-40855f84 data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-764effdf><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-764effdf><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-82b282f1 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-82b282f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-82b282f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/EvilIrving" aria-label="cool link" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="http://yomuki.com/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-faa4ef78 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav fixed reached-top" data-v-6be51355 data-v-5cfd5582><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-5cfd5582 data-v-d5bb9d56><button data-v-d5bb9d56>back top</button><!----></div></div><!----><div class="VPContent" id="VPContent" data-v-6be51355 data-v-3107c4ee><div class="VPDoc has-aside" data-v-3107c4ee data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="left-aside aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-3f215769 data-v-ff0f39c8><div class="content" data-v-ff0f39c8><div class="outline-marker" data-v-ff0f39c8></div><div class="outline-title" data-v-ff0f39c8>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-ff0f39c8><span class="visually-hidden" id="doc-outline-aria-label" data-v-ff0f39c8> Table of Contents for current page </span><ul class="root" data-v-ff0f39c8 data-v-b0ff2abe><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _front_node_Express%20%E6%95%99%E7%A8%8B%E4%B8%A8%E9%98%BF%E8%A5%BF%E6%B2%B3 external-link-icon-enabled" data-v-6b87e69f><div><h2 id="express-js" tabindex="-1">Express.js <a class="header-anchor" href="#express-js" aria-label="Permalink to &quot;Express.js&quot;">​</a></h2><blockquote><p>Express.js 或简称 Express，是针对 Node.js 的 web 应用框架，在 MIT 许可证下作为自由及开放源代码软件发行。设计用来建造 web 应用和 API。它已经被称为针对 Node.js 的服务器框架的事实标准。</p></blockquote><p>最初作者<code>TJ Holowaychuk</code>，将它描述为受 Sinatra 启发的服务器，意味着它是相对极小化的，带有以插件形式获得的很多特征。Express 是 MEAN 软件栈的后端部件，其他部件是 MongoDB 数据库软件和 AngularJS 前端框架。</p><h2 id="历史" tabindex="-1">历史 <a class="header-anchor" href="#历史" aria-label="Permalink to &quot;历史&quot;">​</a></h2><p>Express.js 由 TJ Holowaychuk 创立。首次发行的版本 0.12.0，依据 Express.js 的 GitHub 仓库，是在 2010 年 5 月 22 日。</p><p>在 2014 年 6 月，StrongLoop 获得了项目的管理权 。StrongLoop 在 2015 年 9 月被 IBM 并购。在 2016 年 1 月，IBM 宣布将 Express.js 置于 Node.js 基金会孵化器的管理之下。</p><h2 id="流行度" tabindex="-1">流行度 <a class="header-anchor" href="#流行度" aria-label="Permalink to &quot;流行度&quot;">​</a></h2><p>Express.js 被用于 Fox Sports、PayPal、Uber 和 IBM，Node 框架名副其实的一哥。</p><h2 id="express-4-x-api" tabindex="-1">Express 4.x API <a class="header-anchor" href="#express-4-x-api" aria-label="Permalink to &quot;Express 4.x API&quot;">​</a></h2><p><code>express()</code>用来创建一个 Express 的程序。<code>express()</code>方法是 <em><strong>express</strong></em> 模块导出的顶层方法。</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">var express = require(&#39;express&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">var app = express();</span></span></code></pre></div><h3 id="methods" tabindex="-1">Methods <a class="header-anchor" href="#methods" aria-label="Permalink to &quot;Methods&quot;">​</a></h3><h4 id="express-static-root-options" tabindex="-1">express.static(root, [options]) <a class="header-anchor" href="#express-static-root-options" aria-label="Permalink to &quot;express.static(root, [options])&quot;">​</a></h4><p><code>express.static</code>是 Express 中唯一的内建中间件。它以 <a href="https://github.com/expressjs/serve-static" target="_blank" rel="noreferrer">server-static</a> 模块为基础开发，负责托管 Express 应用内的静态资源。 参数<code>root</code>为静态资源的所在的根目录。 参数<code>options</code>是可选的，支持以下的属性：</p><p><img src="/assets/express.7dc49d58.png" alt="express"></p><p>如果你想获得更多关于使用中间件的细节，你可以查阅 <a href="http://expressjs.com/starter/static-files.html" target="_blank" rel="noreferrer">Serving static files in Express</a>。</p><h3 id="application" tabindex="-1">Application() <a class="header-anchor" href="#application" aria-label="Permalink to &quot;Application()&quot;">​</a></h3><p><code>app</code>对象一般用来表示 Express 程序。通过调用 Express 模块导出的顶层的<code>express()</code>方法来创建它:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello world!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p><code>app</code>对象具有以下的方法：</p><ul><li>路由 HTTP 请求；具体可以看 <a href="http://expressjs.com/4x/api.html#app.METHOD" target="_blank" rel="noreferrer">app.METHOD</a> 和 <a href="http://expressjs.com/4x/api.html#app.param" target="_blank" rel="noreferrer">app.param</a> 这两个例子。</li><li>配置中间件；具体请看 <a href="http://expressjs.com/4x/api.html#app.route" target="_blank" rel="noreferrer">app.route</a>。</li><li>渲染 HTML 视图；具体请看 <a href="http://expressjs.com/4x/api.html#app.render" target="_blank" rel="noreferrer">app.render</a>。</li><li>注册模板引擎；具体请看 <a href="http://expressjs.com/4x/api.html#app.engine" target="_blank" rel="noreferrer">app.engine</a>。</li></ul><p>它还有一些属性设置，这些属性可以改变程序的行为。获得更多的信息，可以查阅 <a href="http://expressjs.com/4x/api.html#app.settings.table" target="_blank" rel="noreferrer">Application settings</a>。</p><h3 id="properties" tabindex="-1">Properties <a class="header-anchor" href="#properties" aria-label="Permalink to &quot;Properties&quot;">​</a></h3><h4 id="app-locals" tabindex="-1">app.locals <a class="header-anchor" href="#app-locals" aria-label="Permalink to &quot;app.locals&quot;">​</a></h4><p><code>app.locals</code>对象是一个 javascript 对象，它的属性就是程序本地的变量。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">locals</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &#39;My App&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">locals</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">email</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &#39;me@myapp.com&#39;</span></span></code></pre></div><p>一旦设定，<code>app.locals</code>的各属性值将贯穿程序的整个生命周期，与其相反的是<code>res.locals</code>，它只在这次请求的生命周期中有效。</p><p>在程序中，你可以在渲染模板时使用这些本地变量。它们是非常有用的，可以为模板提供一些有用的方法，以及<code>app</code>级别的数据。通过<code>req.app.locals</code>(具体查看 <a href="http://expressjs.com/4x/api.html#req.app" target="_blank" rel="noreferrer">req.app</a>)，Locals 可以在中间件中使用。</p><div class="language-hs"><button title="Copy Code" class="copy"></button><span class="lang">hs</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">locals</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> &#39;My App&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">locals</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">strftime </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> require</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">&#39;strftime&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">locals</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">email </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> &#39;me</span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">myapp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com&#39;;</span></span></code></pre></div><h4 id="app-mountpath" tabindex="-1">app.mountpath <a class="header-anchor" href="#app-mountpath" aria-label="Permalink to &quot;app.mountpath&quot;">​</a></h4><p><code>app.mountpath</code>属性是子程序挂载的路径模式。</p><blockquote><p>一个子程序是一个<code>express</code>的实例，其可以被用来作为路由句柄来处理请求。</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// the main app</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> admin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// the sub app</span></span>
<span class="line"><span style="color:#A6ACCD;">admin</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">admin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mountpath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// /admin</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Admin Homepage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/admin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> admin)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// mount the sub app</span></span></code></pre></div><p>它和 req 对象的 <a href="http://expressjs.com/4x/api.html#req.baseUrl" target="_blank" rel="noreferrer">baseUrl</a> 属性比较相似，除了<code>req.baseUrl</code>是匹配的 URL 路径，而不是匹配的模式。如果一个子程序被挂载在多条路径模式，<code>app.mountpath</code>就是一个关于挂载路径模式项的列表，如下面例子所示。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> admin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">admin</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">admin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mountpath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// [&#39;adm*n&#39;, &#39;/manager&#39;] </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Admin Homepage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> secret </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">secret</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">secret</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mountpath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// /secr*t</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Admin secret</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">admin</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">secr*t</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> secret)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// load the &#39;secret&#39; router on &#39;/secr*t&#39;, on the &#39;admin&#39; sub app</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/adm*n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/manager</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> admin)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// load the &#39;admin&#39; router on &#39;/adm*n&#39; and  &#39;/manager&#39; , on the parent app</span></span></code></pre></div><h3 id="events" tabindex="-1">Events <a class="header-anchor" href="#events" aria-label="Permalink to &quot;Events&quot;">​</a></h3><h4 id="app-on-mount-callback-parent" tabindex="-1">app.on(‘mount’, callback(parent)) <a class="header-anchor" href="#app-on-mount-callback-parent" aria-label="Permalink to &quot;app.on(‘mount’, callback(parent))&quot;">​</a></h4><p>当子程序被挂载到父程序时，<code>mount</code>事件被发射。父程序对象作为参数，传递给回调方法。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> admin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">admin</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mount</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">parent</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Admin Mounted</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">parent</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// refers to the parent app</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">admin</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Admin Homepage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/admin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> admin)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h3 id="methods-1" tabindex="-1">Methods <a class="header-anchor" href="#methods-1" aria-label="Permalink to &quot;Methods&quot;">​</a></h3><h4 id="app-all-path-callback-callback" tabindex="-1"><code>app.all(path, callback[, callback …]</code> <a class="header-anchor" href="#app-all-path-callback-callback" aria-label="Permalink to &quot;`app.all(path, callback[, callback …]`&quot;">​</a></h4><p><code>app.all</code>方法和标准的<code>app.METHOD()</code>方法相似，除了它匹配所有的 HTTP 动词。 对于给一个特殊前缀映射一个全局的逻辑处理，或者无条件匹配，它是很有效的。例如，如果你把下面内容放在所有其他的路由定义的前面，它要求所有从这个点开始的路由需要认证和自动加载一个用户。记住这些回调并不是一定是终点:<code>loadUser</code>可以在完成了一个任务后，调用<code>next()</code>方法来继续匹配随后的路由。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> requireAuthentication</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> loadUser)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>或者这种相等的形式:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> requireAuthentication)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> loadUser)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>另一个例子是全局的白名单方法。这个例子和前面的很像，然而它只是限制以<code>/api</code>开头的路径。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/api/*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> requireAuthentication)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="app-delete-path-callback-callback" tabindex="-1"><code>app.delete(path, callback[, callback …])</code> <a class="header-anchor" href="#app-delete-path-callback-callback" aria-label="Permalink to &quot;`app.delete(path, callback[, callback …])`&quot;">​</a></h4><p>路由<code>HTTP DELETE</code>请求到有特殊回调方法的特殊的路径。获取更多的信息，可以查阅 <a href="http://expressjs.com/guide/routing.html" target="_blank" rel="noreferrer">routing guide</a>。 你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果不能满足当前路由的处理条件，那么你可以传递控制到随后的路由。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">delete</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DELETE request to homepage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="app-disable-name" tabindex="-1">app.disable(name) <a class="header-anchor" href="#app-disable-name" aria-label="Permalink to &quot;app.disable(name)&quot;">​</a></h4><p>设置类型为布尔的设置名为<code>name</code>的值为<code>false</code>，此处的<code>name</code>是 <a href="http://expressjs.com/4x/api.html#app.settings.table" target="_blank" rel="noreferrer">app settings table</a> 中各属性的一个。调用<code>app.set(&#39;foo&#39;, false)</code>和调用<code>app.disable(&#39;foo&#39;)</code>是等价的。 比如:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">disable</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; false</span></span></code></pre></div><h4 id="app-disabled-name" tabindex="-1"><code>app.disabled(name)</code> <a class="header-anchor" href="#app-disabled-name" aria-label="Permalink to &quot;`app.disabled(name)`&quot;">​</a></h4><p>返回<code>true</code>如果布尔类型的设置值<code>name</code>被禁用为<code>false</code>，此处的<code>name</code>是 <a href="http://expressjs.com/4x/api.html#app.settings.table" target="_blank" rel="noreferrer">app settings table</a> 中各属性的一个。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">disabled</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; true</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">enable</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">disabled</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; false</span></span></code></pre></div><h4 id="app-enable-name" tabindex="-1">app.enable(name) <a class="header-anchor" href="#app-enable-name" aria-label="Permalink to &quot;app.enable(name)&quot;">​</a></h4><p>设置布尔类型的设置值<code>name</code>为<code>true</code>，此处的<code>name</code>是 <a href="http://expressjs.com/4x/api.html#app.settings.table" target="_blank" rel="noreferrer">app settings table</a> 中各属性的一个。调用<code>app.set(&#39;foo&#39;, true)</code>和调用<code>app.enable(&#39;foo&#39;)</code>是等价的。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">enable</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; true</span></span></code></pre></div><h4 id="app-enabled-name" tabindex="-1">app.enabled(name) <a class="header-anchor" href="#app-enabled-name" aria-label="Permalink to &quot;app.enabled(name)&quot;">​</a></h4><p>返回<code>true</code>如果布尔类型的设置值<code>name</code>被启动为<code>true</code>，此处的<code>name</code>是 <a href="http://expressjs.com/4x/api.html#app.settings.table" target="_blank" rel="noreferrer">app settings table</a> 中各属性的一个。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">enabled</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; false</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">enable</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">enabled</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; true</span></span></code></pre></div><h4 id="app-engine-ext-callback" tabindex="-1"><code>app.engine(ext, callback)</code> <a class="header-anchor" href="#app-engine-ext-callback" aria-label="Permalink to &quot;`app.engine(ext, callback)`&quot;">​</a></h4><p>注册给定引擎的回调，用来渲染处理 ext 文件。 默认情况下，Express 需要使用<code>require()</code>来加载基于文件扩展的引擎。例如，如果你尝试渲染一个<code>foo.jade</code>文件，Express 在内部调用下面的内容，同时缓存<code>require()</code>结果供随后的调用，来加速性能。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">engine</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jade</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jade</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__express)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>使用下面的方法对于那些没有提供开箱即用的<code>.__express</code>方法的模板，或者你希望使用不同的模板引擎扩展。 比如，使用 EJS 模板引擎来渲染<code>.html</code>文件：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">engine</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ejs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">renderFile)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>在这个例子中，EJS 提供了一个<code>.renderFile</code>方法，这个方法满足了 Express 规定的签名规则：<code>(path, options, callback)</code>，然而记住在内部它只是<code>ejs.__express</code>的一个别名，所以你可以在不做任何事的情况下直接使用<code>.ejs</code>扩展。 一些模板引擎没有遵循这种规范，<a href="https://github.com/tj/consolidate.js" target="_blank" rel="noreferrer">consolidate.js</a> 库映射模板引擎以下面的使用方式，所以他们可以无缝的和 Express 工作。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> engines </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">consolidate</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">engine</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">haml</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> engines</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">haml)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">engine</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> engines</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hogan)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="app-get-name" tabindex="-1"><code>app.get(name)</code> <a class="header-anchor" href="#app-get-name" aria-label="Permalink to &quot;`app.get(name)`&quot;">​</a></h4><p>获得设置名为<code>name</code>的 app 设置的值，此处的<code>name</code>是 <a href="http://expressjs.com/4x/api.html#app.settings.table" target="_blank" rel="noreferrer">app settings table</a> 中各属性的一个。 如下：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">title</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; undefined</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">title</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">My Site</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">title</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &#39;My Site&#39;</span></span></code></pre></div><h4 id="app-get-path-callback-callback" tabindex="-1"><code>app.get(path, callback [, callback …])</code> <a class="header-anchor" href="#app-get-path-callback-callback" aria-label="Permalink to &quot;`app.get(path, callback [, callback …])`&quot;">​</a></h4><p>路由<code>HTTP GET</code>请求到有特殊回调的特殊路径。获取更多的信息，可以查阅 <a href="http://expressjs.com/guide/routing.html" target="_blank" rel="noreferrer">routing guide</a>。 你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果请求没能满足当前路由的处理条件，那么传递控制到随后的路由。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET request to homepage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="app-listen-port-hostname-backlog-callback" tabindex="-1"><code>app.listen(port, [hostname], [backlog], [callback])</code> <a class="header-anchor" href="#app-listen-port-hostname-backlog-callback" aria-label="Permalink to &quot;`app.listen(port, [hostname], [backlog], [callback])`&quot;">​</a></h4><p>绑定程序监听端口到指定的主机和端口号。这个方法和<code>Node</code>中的 <a href="http://nodejs.org/api/http.html#http_server_listen_port_hostname_backlog_callback" target="_blank" rel="noreferrer">http.Server.listen()</a> 是一样的。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>通过调用<code>express()</code>返回得到的<code>app</code>实际上是一个 JavaScript 的<code>Function</code>，被设计用来作为一个回调传递给<code>Node HTTP servers</code>来处理请求。这样，其就可以很简便的基于同一份代码提供 http 和 https 版本，所以 app 没有从这些继承 (它只是一个简单的回调)。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> https </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> http </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createServer</span><span style="color:#A6ACCD;">(app)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">https</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createServer</span><span style="color:#A6ACCD;">(options</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> app)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">443</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p><code>app.listen()</code>方法是下面所示的一个便利的方法 (只针对 HTTP 协议):</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">server</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createServer</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">listen</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arguments</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><h4 id="app-method-path-callback-callback" tabindex="-1"><code>app.METHOD(path, callback [, callback …])</code> <a class="header-anchor" href="#app-method-path-callback-callback" aria-label="Permalink to &quot;`app.METHOD(path, callback [, callback …])`&quot;">​</a></h4><p>路由一个 HTTP 请求，<code>METHOD</code>是这个请求的 HTTP 方法，比如<code>GET</code>，<code>PUT</code>，<code>POST</code>等等，注意是小写的。所以，实际的方法是<code>app.get()</code>，<code>app.post()</code>，<code>app.put()</code>等等。下面有关于方法的完整的表。 获取更多信息，请看 <a href="http://expressjs.com/guide/routing.html" target="_blank" rel="noreferrer">routing guide</a>。 Express 支持下面的路由方法，对应与同名的 HTTP 方法：</p><p><img src="/assets/http.4bfc44da.png" alt="http"></p><blockquote><p>如果使用上述方法时，导致了无效的 javascript 的变量名，可以使用中括号符号，比如,<code>app[&#39;m-search&#39;](&#39;/&#39;, function ...</code></p></blockquote><p>你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果请求没有满足当前路由的处理条件，那么传递控制到随后的路由。</p><blockquote><p>本 API 文档把使用比较多的 HTTP 方法<code>app.get()</code>，<code>app.post</code>，<code>app.put()</code>，<code>app.delete()</code>作为一个个单独的项进行说明。然而，其他上述列出的方法以完全相同的方式工作。</p></blockquote><p><code>app.all()</code>是一个特殊的路由方法，它不属于 HTTP 协议中的规定的方法。它为一个路径加载中间件，其对所有的请求方法都有效。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/secret</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Accessing the secret section...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// pass control to the next handler</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="app-param-name-callback" tabindex="-1">app.param([name], callback) <a class="header-anchor" href="#app-param-name-callback" aria-label="Permalink to &quot;app.param([name], callback)&quot;">​</a></h4><p>给路由参数添加回调触发器，这里的<code>name</code>是参数名或者参数数组，<code>function</code>是回调方法。回调方法的参数按序是<code>请求对象</code>，<code>响应对象</code>，<code>下个中间件</code>，<code>参数值</code>和<code>参数名</code>。 如果<code>name</code>是数组，会按照各个参数在数组中被声明的顺序将回调触发器注册下来。还有，对于除了最后一个参数的其他参数，在他们的回调中调用<code>next()</code>来调用下个声明参数的回调。对于最后一个参数，在回调中调用<code>next()</code>将调用位于当前处理路由中的下一个中间件，如果<code>name</code>只是一个<code>string</code>那就和它是一样的 (就是说只有一个参数，那么就是最后一个参数，和数组中最后一个参数是一样的)。 例如，当<code>:user</code>出现在路由路径中，你可以映射用户加载的逻辑处理来自动提供<code>req.user</code>给这个路由，或者对输入的参数进行验证。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">param</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">User</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">error</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">user</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">user</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">failed to load user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>对于<code>Param</code>的回调定义的路由来说，他们是局部的。它们不会被挂载的 app 或者路由继承。所以，定义在<code>app</code>上的<code>Param</code>回调只有是在<code>app</code>上的路由具有这个路由参数时才起作用。 在定义<code>param</code>的路由上，<code>param</code>回调都是第一个被调用的，它们在一个请求 - 响应循环中都会被调用一次并且只有一次，即使多个路由都匹配，如下面的例子：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">param</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CALLED ONLY ONCE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user/:id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">although this matches</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user/:id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">and this mathces too</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">end</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>当<code>GET /user/42</code>，得到下面的结果:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">CALLED ONLY ONCE</span></span>
<span class="line"><span style="color:#A6ACCD;">    although </span><span style="color:#89DDFF;">this</span><span style="color:#A6ACCD;"> matches</span></span>
<span class="line"><span style="color:#A6ACCD;">    and </span><span style="color:#89DDFF;">this</span><span style="color:#A6ACCD;"> matches too</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">param</span><span style="color:#A6ACCD;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">page</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CALLED ONLY ONCE with</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user/:id/:page</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req. </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">although this matches</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user/:id/:page</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">and this matches too</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">end</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>当执行<code>GET /user/42/3</code>，结果如下：</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">CALLED ONLY ONCE with 42</span></span>
<span class="line"><span style="color:#A6ACCD;">CALLED ONLY ONCE with 3</span></span>
<span class="line"><span style="color:#A6ACCD;">although this matches</span></span>
<span class="line"><span style="color:#A6ACCD;">and this mathes too</span></span></code></pre></div><h4 id="app-path" tabindex="-1">app.path() <a class="header-anchor" href="#app-path" aria-label="Permalink to &quot;app.path()&quot;">​</a></h4><p>通过这个方法可以得到<code>app</code>典型的路径，其是一个<code>string</code>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> blog </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> blogAdmin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/blog</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> blog)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/admin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> blogAdmin)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">path</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// &#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(blog</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">path</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// &#39;/blog&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(blogAdmin</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">path</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// &#39;/blog/admin&#39;</span></span></code></pre></div><p>如果<code>app</code>挂载很复杂下，那么这个方法的行为也会很复杂：一种更好用的方式是使用<code>req.baseUrl</code>来获得这个 app 的典型路径。</p><h4 id="app-post-path-callback-callback" tabindex="-1">app.post(path, callback, [callback …]) <a class="header-anchor" href="#app-post-path-callback-callback" aria-label="Permalink to &quot;app.post(path, callback, [callback …])&quot;">​</a></h4><p>路由<code>HTTP POST</code>请求到有特殊回调的特殊路径。获取更多的信息，可以查阅 <a href="http://expressjs.com/guide/routing.html" target="_blank" rel="noreferrer">routing guide</a>。 你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果请求没能满足当前路由的处理条件，那么传递控制到随后的路由。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST request to homepage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="app-put-path-callback-callback" tabindex="-1">app.put(path, callback, [callback …]) <a class="header-anchor" href="#app-put-path-callback-callback" aria-label="Permalink to &quot;app.put(path, callback, [callback …])&quot;">​</a></h4><p>路由<code>HTTP PUT</code>请求到有特殊回调的特殊路径。获取更多的信息，可以查阅 <a href="http://expressjs.com/guide/routing.html" target="_blank" rel="noreferrer">routing guide</a>。 你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果请求没能满足当前路由的处理条件，那么传递控制到随后的路由。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">put</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PUT request to homepage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="app-render-view-locals-callback" tabindex="-1">app.render(view, [locals], callback) <a class="header-anchor" href="#app-render-view-locals-callback" aria-label="Permalink to &quot;app.render(view, [locals], callback)&quot;">​</a></h4><p>通过<code>callback</code>回调返回一个<code>view</code>渲染之后得到的 HTML 文本。它可以接受一个可选的参数，可选参数包含了这个<code>view</code>需要用到的本地数据。这个方法类似于<code>res.render()</code>，<strong>除了它不能把渲染得到的 HTML 文本发送给客户端</strong>。</p><blockquote><p>将<code>app.render()</code>当作是可以生成渲染视图字符串的工具方法。在<code>res.render()</code>内部，就是使用的<code>app.render()</code>来渲染视图。</p></blockquote><blockquote><p>如果使能了视图缓存，那么本地变量缓存就会保留。如果你想在开发的过程中缓存视图，设置它为<code>true</code>。在生产环境中，视图缓存默认是打开的。</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">email</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">html</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">email</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Tobi</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">html</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="app-route-path" tabindex="-1">app.route(path) <a class="header-anchor" href="#app-route-path" aria-label="Permalink to &quot;app.route(path)&quot;">​</a></h4><p>返回一个单例模式的路由的实例，之后你可以在其上施加各种 HTTP 动作的中间件。使用<code>app.route()</code>来避免重复路由名字 (例如错字错误)–说的意思应该是使用<code>app.router()</code>这个单例方法来避免同一个路径多个路由实例。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/events</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// runs for all HTTP verbs first</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// think of it as route specific middleware!</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// maybe add a new event...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h4 id="app-set-name-value" tabindex="-1">app.set(name, value) <a class="header-anchor" href="#app-set-name-value" aria-label="Permalink to &quot;app.set(name, value)&quot;">​</a></h4><p>给<code>name</code>设置项赋<code>value</code>值，<code>name</code>是 <a href="http://expressjs.com/4x/api.html#app.settings.table" target="_blank" rel="noreferrer">app settings table</a> 中属性的一项。 对于一个类型是布尔型的属性调用<code>app.set(&#39;foo&#39;, ture)</code>等价于调用<code>app.enable(&#39;foo&#39;)</code>。同样的，调用<code>app.set(&#39;foo&#39;, false)</code>等价于调用<code>app.disable(&#39;foo&#39;)</code>。 可以使用<code>app.get()</code>来取得设置的值：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">title</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">My Site</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">title</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// &#39;My Site&#39;</span></span></code></pre></div><p><strong>Application Settings</strong> 如果<code>name</code>是程序设置之一，它将影响到程序的行为。下边列出了程序中的设置。</p><p><img src="/assets/option.b3db9f17.png" alt="option"></p><p><strong>Options for <code>trust proxy</code> settings</strong></p><p>查阅 <a href="http://expressjs.com/guide/behind-proxies.html" target="_blank" rel="noreferrer">Express behind proxies</a> 来获取更多信息。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">trust proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">ip</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">ip</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">127.0.0.1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ip</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">123.123.123.123</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p><strong>Options for <code>etag</code> settings</strong></p><p><code>ETag</code>功能的实现使用了 <a href="https://www.npmjs.org/package/etag" target="_blank" rel="noreferrer">etag</a> 包。如果你需要获得更多的信息，你可以查阅它的文档。</p><h4 id="app-use-path-function-function" tabindex="-1"><code>app.use([path,], function [, function…])</code> <a class="header-anchor" href="#app-use-path-function-function" aria-label="Permalink to &quot;`app.use([path,], function [, function…])`&quot;">​</a></h4><p>挂载<a href="http://expressjs.com/guide/using-middleware.html" target="_blank" rel="noreferrer">中间件</a>方法到路径上。如果路径未指定，那么默认为 &quot;/&quot;。</p><blockquote><p>一个路由将匹配任何路径如果这个路径以这个路由设置路径后紧跟着 &quot;/&quot;。比如：<code>app.use(&#39;/appale&#39;, ...)</code>将匹配 &quot;/apple&quot;，&quot;/apple/images&quot;，&quot;/apple/images/news&quot; 等。</p></blockquote><p>中间件中的<code>req.originalUrl</code>是<code>req.baseUrl</code>和<code>req.path</code>的组合，如下面的例子所示。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/admin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// GET &#39;http://www.example.com/admin/new&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalUrl</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// &#39;/admin/new&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">baseUrl</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// &#39;/admin&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">// &#39;/new&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>在一个路径上挂载一个中间件之后，每当请求的路径的前缀部分匹配了这个路由路径，那么这个中间件就会被执行。 由于默认的路径为<code>/</code>，中间件挂载没有指定路径，那么对于每个请求，这个中间件都会被执行。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// this middleware will be executed for every request to the app.</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Time: %d</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Date</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>中间件方法是顺序处理的，所以中间件包含的顺序是很重要的。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// this middleware will not allow the request to  go beyond it</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello World</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// this middleware will never reach this route</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Welcome</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>路径可以是代表路径的一串字符，一个路径模式，一个匹配路径的正则表达式，或者他们的一组集合。</p><p>下面是一些例子，在<code>Express</code>程序中使用<code>express.static</code>中间件。 为程序托管位于程序目录下的<code>public</code>目录下的静态资源：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// GET /style.css etc</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">static</span><span style="color:#A6ACCD;">(__dirname </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/public</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>在<code>/static</code>路径下挂载中间件来提供静态资源托管服务，只当请求是以<code>/static</code>为前缀的时候。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// GET /static/style.css etc.</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/static</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">static</span><span style="color:#A6ACCD;">(express</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__dirname </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/public</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>通过在设置静态资源中间件之后加载日志中间件来关闭静态资源请求的日志。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">static</span><span style="color:#A6ACCD;">(__dirname </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/public</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">logger</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>托管静态资源从不同的路径，但<code>./public</code>路径比其他更容易被匹配：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">static</span><span style="color:#A6ACCD;">(__dirname </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/public</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">static</span><span style="color:#A6ACCD;">(__dirname </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/files</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">static</span><span style="color:#A6ACCD;">(__dirname </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/uploads</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h2 id="request" tabindex="-1">Request <a class="header-anchor" href="#request" aria-label="Permalink to &quot;Request&quot;">​</a></h2><p><code>req</code>对象代表了一个 HTTP 请求，其具有一些属性来保存请求中的一些数据，比如<code>query string</code>，<code>parameters</code>，<code>body</code>，<code>HTTP headers</code>等等。在本文档中，按照惯例，这个对象总是简称为<code>req</code>(http 响应简称为<code>res</code>)，但是它们实际的名字由这个回调方法在那里使用时的参数决定。 如下例子:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app.get(&#39;/user/:id&#39;, function(req, res) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        res.send(&#39;user&#39; + req.params.id);</span></span>
<span class="line"><span style="color:#A6ACCD;">    });</span></span></code></pre></div><p>其实你也可以这样写：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user/:id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">response</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">params</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h3 id="properties-1" tabindex="-1">Properties <a class="header-anchor" href="#properties-1" aria-label="Permalink to &quot;Properties&quot;">​</a></h3><p>在<code>Express 4</code>中，<code>req.files</code>默认在<code>req</code>对象中不再是可用的。为了通过<code>req.files</code>对象来获得上传的文件，你可以使用一个<code>multipart-handling</code>(多种处理的工具集) 中间件，比如<code>busboy</code>，<code>multer</code>，<code>formidable</code>，<code>multipraty</code>，<code>connect-multiparty</code>或者<code>pez</code>。</p><h4 id="req-app" tabindex="-1">req.app <a class="header-anchor" href="#req-app" aria-label="Permalink to &quot;req.app&quot;">​</a></h4><p>这个属性持有<code>express</code>程序实例的一个引用，其可以作为中间件使用。 如果你按照这个模式，你创建一个模块导出一个中间件，这个中间件只在你的主文件中<code>require()</code>它，那么这个中间件可以通过<code>req.app</code>来获取 express 的实例。 例如:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// index.js</span></span>
<span class="line"><span style="color:#A6ACCD;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/viewdirectory</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./mymiddleware.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// mymiddleware.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">The views directory is </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">views</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><h4 id="req-baseurl" tabindex="-1">req.baseUrl <a class="header-anchor" href="#req-baseurl" aria-label="Permalink to &quot;req.baseUrl&quot;">​</a></h4><p>一个路由实例挂载的 Url 路径。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> greet </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Router</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    greet</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/jp</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">baseUrl</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// greet</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Konichiwa!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/greet</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> greet)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>即使你使用的路径模式或者一系列路径模式来加载路由，<code>baseUrl</code>属性返回匹配的字符串，而不是路由模式。下面的例子，<code>greet</code>路由被加载在两个路径模式上。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/gre+t</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hel{2}o</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> greet)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// load the on router on &#39;/gre+t&#39; and &#39;/hel{2}o&#39;</span></span></code></pre></div><p>当一个请求路径是<code>/greet/jp</code>，<code>baseUrl</code>是<code>/greet</code>，当一个请求路径是<code>/hello/jp</code>，<code>req.baseUrl</code>是<code>/hello</code>。 <code>req.baseUrl</code>和<code>app</code>对象的 <a href="http://expressjs.com/4x/api.html#app.mountpath" target="_blank" rel="noreferrer">mountpath</a> 属性相似，除了<code>app.mountpath</code>返回的是路径匹配模式。</p><h4 id="req-body" tabindex="-1">req.body <a class="header-anchor" href="#req-body" aria-label="Permalink to &quot;req.body&quot;">​</a></h4><p>在请求的 body 中保存的是提交的一对对键值数据。默认情况下，它是<code>undefined</code>，当你使用比如<code>body-parser</code>和<code>multer</code>这类解析<code>body</code>数据的中间件时，它是填充的。 下面的例子，给你展示了怎么使用<code>body-parser</code>中间件来填充<code>req.body</code>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> bodyParser </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">body-parser</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> multer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">multer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)；</span><span style="color:#676E95;font-style:italic;">// v1.0.5</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> upload </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">multer</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// for parsing multipart/form-data</span></span>
<span class="line"><span style="color:#A6ACCD;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(bodyParser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// for parsing application/json</span></span>
<span class="line"><span style="color:#A6ACCD;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(bodyParser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">urlencoded</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">extended</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// for parsing application/x-www-form-urlencoded</span></span>
<span class="line"><span style="color:#A6ACCD;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/profile</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> upload</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">array</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="req-cookies" tabindex="-1">req.cookies <a class="header-anchor" href="#req-cookies" aria-label="Permalink to &quot;req.cookies&quot;">​</a></h4><p>当使用<code>cookie-parser</code>中间件的时候，这个属性是一个对象，其包含了请求发送过来的<code>cookies</code>。如果请求没有带<code>cookies</code>，那么其值为<code>{}</code>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Cookie: name=tj</span></span>
<span class="line"><span style="color:#A6ACCD;">    req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cookies</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// =&gt; &quot;tj&quot;</span></span></code></pre></div><p>获取更多信息，问题，或者关注，可以查阅 <a href="https://github.com/expressjs/cookie-parser" target="_blank" rel="noreferrer">cookie-parser</a>。</p><h4 id="req-fresh" tabindex="-1">req.fresh <a class="header-anchor" href="#req-fresh" aria-label="Permalink to &quot;req.fresh&quot;">​</a></h4><p>指示这个请求是否是新鲜的。其和<code>req.stale</code>是相反的。 当<code>cache-control</code>请求头没有<code>no-cache</code>指示和下面中的任一一个条件为<code>true</code>，那么其就为<code>true</code>：</p><ul><li><code>if-modified-since</code>请求头被指定，和<code>last-modified</code>请求头等于或者早于<code>modified</code>响应头。</li><li><code>if-none-match</code>请求头是<code>*</code>。</li><li><code>if-none-match</code>请求头在被解析进它的指令之后，和<code>etag</code>响应头的值不相等</li></ul><blockquote><p>ps:If-None-Match 作用: If-None-Match 和 ETag 一起工作，工作原理是在 HTTP Response 中添加 ETag 信息。 当用户再次请求该资源时，将在 HTTP Request 中加入 If-None-Match 信息 (ETag 的值)。如果服务器验证资源的 ETag 没有改变（该资源没有更新），将返回一个 304 状态告诉客户端使用本地缓存文件。否则将返回 200 状态和新的资源和 Etag. 使用这样的机制将提高网站的性能</p></blockquote><h4 id="req-hostname" tabindex="-1">req.hostname <a class="header-anchor" href="#req-hostname" aria-label="Permalink to &quot;req.hostname&quot;">​</a></h4><p>包含了源自<code>Host</code>HTTP 头部的<code>hostname</code>。 当<code>trust proxy</code>设置项被设置为启用值，<code>X-Forwarded-Host</code>头部被使用来代替<code>Host</code>。这个头部可以被客户端或者代理设置。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Host: &quot;example.com&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostname</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;example.com&quot;</span></span></code></pre></div><h4 id="req-ips" tabindex="-1">req.ips <a class="header-anchor" href="#req-ips" aria-label="Permalink to &quot;req.ips&quot;">​</a></h4><p>当<code>trust proxy</code>设置项被设置为启用值，这个属性包含了一组在<code>X-Forwarded-For</code>请求头中指定的 IP 地址。不然，其就包含一个空的数组。这个头部可以被客户端或者代理设置。 例如，如果<code>X-Forwarded-For</code>是<code>client</code>，<code>proxy1</code>，<code>proxy2</code>，<code>req.ips</code>就是<code>[&quot;clinet&quot;, &quot;proxy1&quot;, &quot;proxy2&quot;]</code>，这里<code>proxy2</code>就是最远的下游。</p><h4 id="req-originalurl" tabindex="-1">req.originalUrl <a class="header-anchor" href="#req-originalurl" aria-label="Permalink to &quot;req.originalUrl&quot;">​</a></h4><blockquote><p><code>req.url</code>不是一个原生的<code>Express</code>属性，它继承自 <a href="https://nodejs.org/api/http.html#http_message_url" target="_blank" rel="noreferrer">Node’s http module</a>。</p></blockquote><p>这个属性很像<code>req.url</code>；然而，其保留了原版的请求链接，允许你自由地重定向<code>req.url</code>到内部路由。比如，<code>app.use()</code>的<code>mounting</code>特点可以重定向<code>req.url</code>跳转到挂载点。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// GET /search?q=something</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalUrl</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;/search?q=something&quot;</span></span></code></pre></div><h4 id="req-params" tabindex="-1">req.params <a class="header-anchor" href="#req-params" aria-label="Permalink to &quot;req.params&quot;">​</a></h4><p>一个对象，其包含了一系列的属性，这些属性和在路由中命名的参数名是一一对应的。例如，如果你有<code>/user/:name</code>路由，<code>name</code>属性可作为<code>req.params.name</code>。这个对象默认值为<code>{}</code>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// GET /user/tj</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">params</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;tj&quot;</span></span></code></pre></div><p>当你使用正则表达式来定义路由规则，捕获组的组合一般使用<code>req.params[n]</code>，这里的<code>n</code>是第几个捕获租。这个规则被施加在无名通配符匹配，比如<code>/file/*</code>的路由：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// GET /file/javascripts/jquery.js</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">params[</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;javascripts/jquery.js&quot;</span></span></code></pre></div><h4 id="req-path" tabindex="-1">req.path <a class="header-anchor" href="#req-path" aria-label="Permalink to &quot;req.path&quot;">​</a></h4><p>包含请求 URL 的部分路径。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// example.com/users?sort=desc</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;/users&quot;</span></span></code></pre></div><blockquote><p>当在一个中间件中被调用，挂载点不包含在<code>req.path</code>中。你可以查阅 <a href="http://expressjs.com/4x/api.html#app.use" target="_blank" rel="noreferrer">app.use()</a> 获得跟多的信息。</p></blockquote><h4 id="req-protocol" tabindex="-1">req.protocol <a class="header-anchor" href="#req-protocol" aria-label="Permalink to &quot;req.protocol&quot;">​</a></h4><p>请求的协议，一般为<code>http</code>，当启用 TLS 加密，则为<code>https</code>。 当<code>trust proxy</code>设置一个启用的参数，如果存在<code>X-Forwarded-Proto</code>头部的话，其将被信赖和使用。这个头部可以被客户端或者代理设置。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ptotocol</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;http&quot;</span></span></code></pre></div><h4 id="req-query" tabindex="-1">req.query <a class="header-anchor" href="#req-query" aria-label="Permalink to &quot;req.query&quot;">​</a></h4><p>一个对象，为每一个路由中的<code>query string</code>参数都分配一个属性。如果没有<code>query string</code>，它就是一个空对象，<code>{}</code>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// GET /search?q=tobi+ferret</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">query</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">q</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;tobi ferret&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// GET /shoes?order=desc&amp;shoe[color]=blue&amp;shoe[type]=converse</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">query</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">order</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;desc&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">query</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">shoe</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">color</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;blue&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">query</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">shoe</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">type</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;converse&quot;</span></span></code></pre></div><h4 id="req-route" tabindex="-1">req.route <a class="header-anchor" href="#req-route" aria-label="Permalink to &quot;req.route&quot;">​</a></h4><p>当前匹配的路由，其为一串字符。比如：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user/:id?</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">userIdHandler</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">route</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>前面片段的输出为:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">path</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/user/:id?</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">stack</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    [</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> handle</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">Function</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">userIdHandler</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          name</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">userIdHandler</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          params</span><span style="color:#89DDFF;">:undefined,</span></span>
<span class="line"><span style="color:#F07178;">          path</span><span style="color:#89DDFF;">:undefined,</span></span>
<span class="line"><span style="color:#F07178;">          keys</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">[]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          regexp</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#A6ACCD;">\/</span><span style="color:#89DDFF;">?</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">i</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          method</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    ]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">methods</span><span style="color:#89DDFF;">:{</span><span style="color:#FFCB6B;">get</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="req-secure" tabindex="-1">req.secure <a class="header-anchor" href="#req-secure" aria-label="Permalink to &quot;req.secure&quot;">​</a></h4><p>一个布尔值，如果建立的是 TLS 的连接，那么就为<code>true</code>。等价与：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">protocol</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="req-signedcookies" tabindex="-1">req.signedCookies <a class="header-anchor" href="#req-signedcookies" aria-label="Permalink to &quot;req.signedCookies&quot;">​</a></h4><p>当使用<code>cookie-parser</code>中间件的时候，这个属性包含的是请求发过来的签名<code>cookies</code>，这个属性取得的是不含签名，可以直接使用的值。签名的<code>cookies</code>保存在不同的对象中来体现开发者的意图；不然，一个恶意攻击可以被施加在<code>req.cookie</code>值上 (它是很容易被欺骗的)。记住，签名一个<code>cookie</code>不是把它藏起来或者加密；而是简单的防止篡改 (因为签名使用的加密是私人的)。如果没有发送签名的<code>cookie</code>，那么这个属性默认为<code>{}</code>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Cookie： user=tobi.CP7AWaXDfAKIRfH49dQzKJx7sKzzSoPq7/AcBBRVwlI3</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">signedCookies</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">user</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;tobi&quot;</span></span></code></pre></div><p>为了获取更多的信息，问题或者关注，可以参阅 <a href="https://github.com/expressjs/cookie-parser" target="_blank" rel="noreferrer">cookie-parser</a>。</p><h4 id="req-stale" tabindex="-1">req.stale <a class="header-anchor" href="#req-stale" aria-label="Permalink to &quot;req.stale&quot;">​</a></h4><p>指示这个请求是否是<code>stale</code>(陈旧的)，它与<code>req.fresh</code>是相反的。更多信息，可以查看 <a href="http://expressjs.com/4x/api.html#req.fresh" target="_blank" rel="noreferrer">req.fresh</a>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">stale</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; true</span></span></code></pre></div><h4 id="req-subdomains" tabindex="-1">req.subdomains <a class="header-anchor" href="#req-subdomains" aria-label="Permalink to &quot;req.subdomains&quot;">​</a></h4><p>请求中域名的子域名数组。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Host: &quot;tobi.ferrets.example.com&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">subdomains</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; [&quot;ferrets&quot;, &quot;tobi&quot;]</span></span></code></pre></div><h4 id="req-xhr" tabindex="-1">req.xhr <a class="header-anchor" href="#req-xhr" aria-label="Permalink to &quot;req.xhr&quot;">​</a></h4><p>一个布尔值，如果<code>X-Requested-With</code>的值为<code>XMLHttpRequest</code>，那么其为<code>true</code>，其指示这个请求是被一个客服端库发送，比如<code>jQuery</code>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">xhr</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; true</span></span></code></pre></div><h3 id="methods-2" tabindex="-1">Methods <a class="header-anchor" href="#methods-2" aria-label="Permalink to &quot;Methods&quot;">​</a></h3><h4 id="req-accepts-types" tabindex="-1">req.accepts(types) <a class="header-anchor" href="#req-accepts-types" aria-label="Permalink to &quot;req.accepts(types)&quot;">​</a></h4><p>检查这个指定的内容类型是否被接受，基于请求的<code>Accept</code> HTTP 头部。这个方法返回最佳匹配，如果没有一个匹配，那么其返回<code>undefined</code>(在这个 case 下，服务器端应该返回 406 和 &quot;Not Acceptable&quot;)。 <code>type</code>值可以是一个单的<code>MIME type</code>字符串 (比如<code>application/json</code>)，一个扩展名比如<code>json</code>，一个逗号分隔的列表，或者一个数组。对于一个列表或者数组，这个方法返回最佳项 (如果有的话)。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Accept: text/html</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accepts</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;html&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Accept: text/*, application/json</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accepts</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;html&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accepts</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">text/html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;text/html&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accepts</span><span style="color:#A6ACCD;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;json&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accepts</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">application/json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;application/json&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Accept: text/*, application/json</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accepts</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">image/png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accepts</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; undefined</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Accept: text/*;q=.5, application/json</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accepts</span><span style="color:#A6ACCD;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;json&quot;</span></span></code></pre></div><p>获取更多信息，或者如果你有问题或关注，可以参阅 <a href="https://github.com/expressjs/accepts" target="_blank" rel="noreferrer">accepts</a>。</p><h4 id="req-acceptscharsets-charset" tabindex="-1">req.acceptsCharsets(charset[, …]) <a class="header-anchor" href="#req-acceptscharsets-charset" aria-label="Permalink to &quot;req.acceptsCharsets(charset[, …])&quot;">​</a></h4><p>返回指定的字符集集合中第一个的配置的字符集，基于请求的<code>Accept-Charset</code>HTTP 头。如果指定的字符集没有匹配的，那么就返回 false。 获取更多信息，或者如果你有问题或关注，可以参阅 <a href="https://github.com/expressjs/accepts" target="_blank" rel="noreferrer">accepts</a>。</p><h4 id="req-acceptsencodings-encoding" tabindex="-1">req.acceptsEncodings(encoding[, …]) <a class="header-anchor" href="#req-acceptsencodings-encoding" aria-label="Permalink to &quot;req.acceptsEncodings(encoding[, …])&quot;">​</a></h4><p>返回指定的编码集合中第一个的配置的编码，基于请求的<code>Accept-Encoding</code>HTTP 头。如果指定的编码集没有匹配的，那么就返回 false。 获取更多信息，或者如果你有问题或关注，可以参阅 <a href="https://github.com/expressjs/accepts" target="_blank" rel="noreferrer">accepts</a>。</p><h4 id="req-acceptslanguages-lang" tabindex="-1">req.acceptsLanguages(lang [, …]) <a class="header-anchor" href="#req-acceptslanguages-lang" aria-label="Permalink to &quot;req.acceptsLanguages(lang [, …])&quot;">​</a></h4><p>返回指定的语言集合中第一个的配置的语言，基于请求的<code>Accept-Language</code>HTTP 头。如果指定的语言集没有匹配的，那么就返回 false。 获取更多信息，或者如果你有问题或关注，可以参阅 <a href="https://github.com/expressjs/accepts" target="_blank" rel="noreferrer">accepts</a>。</p><h4 id="req-get-field" tabindex="-1">req.get(field) <a class="header-anchor" href="#req-get-field" aria-label="Permalink to &quot;req.get(field)&quot;">​</a></h4><p>返回指定的请求 HTTP 头部的域内容 (不区分大小写)。<code>Referrer</code>和<code>Referer</code>的域内容可互换。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">req.get(&#39;Content-type&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">// =&gt; &quot;text/plain&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">req.get(&#39;content-type&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">// =&gt; &quot;text/plain&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">req.get(&#39;Something&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">// =&gt; undefined</span></span></code></pre></div><p>其是<code>req.header(field)</code>的别名。</p><h4 id="req-is-type" tabindex="-1">req.is(type) <a class="header-anchor" href="#req-is-type" aria-label="Permalink to &quot;req.is(type)&quot;">​</a></h4><p>如果进来的请求的<code>Content-type</code>头部域匹配参数<code>type</code>给定的<code>MIME type</code>，那么其返回<code>true</code>。否则返回<code>false</code>。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// With Content-Type: text/html; charset=utf-8</span></span>
<span class="line"><span style="color:#A6ACCD;">req.is(&#39;html&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">req.is(&#39;text/html&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">req.is(&#39;text/*&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">// =&gt; true</span></span>
<span class="line"><span style="color:#A6ACCD;">// When Content-Type is application/json</span></span>
<span class="line"><span style="color:#A6ACCD;">req.is(&#39;json&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">req.is(&#39;application/json&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">req.is(&#39;application/*&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">// =&gt; true</span></span>
<span class="line"><span style="color:#A6ACCD;">req.is(&#39;html&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">// =&gt; false</span></span></code></pre></div><p>获取更多信息，或者如果你有问题或关注，可以参阅 <a href="https://github.com/expressjs/type-is" target="_blank" rel="noreferrer">type-is</a>。</p><h4 id="req-param-naem-defaultvalue" tabindex="-1">req.param(naem, [, defaultValue]) <a class="header-anchor" href="#req-param-naem-defaultvalue" aria-label="Permalink to &quot;req.param(naem, [, defaultValue])&quot;">​</a></h4><blockquote><p>过时的。可以在适合的情况下，使用<code>req.params</code>，<code>req.body</code>或者<code>req.query</code>。</p></blockquote><p>返回当前参数<code>name</code>的值。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ?name=tobi</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">param</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;tobi&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// POST name=tobi</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">param</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;tobi&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// /user/tobi for /user/:name</span></span>
<span class="line"><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">param</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;tobi&quot;</span></span></code></pre></div><p>按下面给出的顺序查找：</p><ul><li>req.params</li><li>req.body</li><li>req.query</li></ul><p>可选的，你可以指定一个<code>defaultValue</code>来设置一个默认值，如果这个参数在任何一个请求的对象中都不能找到。</p><blockquote><p>直接通过<code>req.params</code>，<code>req.body</code>，<code>req.query</code>取得应该更加的清晰 - 除非你确定每一个对象的输入。 <code>Body-parser</code>中间件必须加载，如果你使用<code>req.param()</code>。详细请看 <a href="http://expressjs.com/4x/api.html#req.body" target="_blank" rel="noreferrer">req.body</a>。</p></blockquote><h2 id="response" tabindex="-1">Response <a class="header-anchor" href="#response" aria-label="Permalink to &quot;Response&quot;">​</a></h2><p><code>res</code>对象代表了当一个 HTTP 请求到来时，<code>Express</code>程序返回的 HTTP 响应。在本文档中，按照惯例，这个对象总是简称为<code>res</code>(http 请求简称为<code>req</code>)，但是它们实际的名字由这个回调方法在那里使用时的参数决定。 例如：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app.get(&#39;/user/:id&#39;, function(req, res) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.send(&#39;user&#39; + req.params.id);</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><p>这样写也是一样的：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app.get(&#39;/user/:id&#39;, function(request, response) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    response.send(&#39;user&#39; + request.params.id);</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><h3 id="properties-2" tabindex="-1">Properties <a class="header-anchor" href="#properties-2" aria-label="Permalink to &quot;Properties&quot;">​</a></h3><h4 id="res-app" tabindex="-1">res.app <a class="header-anchor" href="#res-app" aria-label="Permalink to &quot;res.app&quot;">​</a></h4><p>这个属性持有<code>express</code>程序实例的一个引用，其可以在中间件中使用。 <code>res.app</code>和请求对象中的<code>req.app</code>属性是相同的。</p><p>布尔类型的属性，指示这个响应是否已经发送 HTTP 头部。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">headersSent</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// false</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">OK</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// send之后就发送了头部</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">headersSent</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// true</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="res-locals" tabindex="-1">res.locals <a class="header-anchor" href="#res-locals" aria-label="Permalink to &quot;res.locals&quot;">​</a></h4><p>一个对象，其包含了本次请求的响应中的变量和因此它的变量只提供给本次请求响应的周期内视图渲染里使用 (如果有视图的话)。 其他方面，其和<code>app.locals</code>是一样的。 这个参数在导出请求级别的信息是很有效的，这些信息比如请求路径，已认证的用户，用户设置等等。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app.use(function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.locals.user = req.user;</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.locals.authenticated = !req.user.anonymous;</span></span>
<span class="line"><span style="color:#A6ACCD;">    next();</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><h3 id="methods-3" tabindex="-1">Methods <a class="header-anchor" href="#methods-3" aria-label="Permalink to &quot;Methods&quot;">​</a></h3><h4 id="res-append-field-value" tabindex="-1">res.append(field [, value]) <a class="header-anchor" href="#res-append-field-value" aria-label="Permalink to &quot;res.append(field [, value])&quot;">​</a></h4><blockquote><p>res.append() 方法在<code>Expresxs</code>4.11.0 以上版本才支持。</p></blockquote><p>在指定的<code>field</code>的 HTTP 头部追加特殊的值<code>value</code>。如果这个头部没有被设置，那么将用<code>value</code>新建这个头部。<code>value</code>可以是一个字符串或者数组。 注意：在<code>res.append()</code>之后调用<code>app.set()</code>函数将重置前面设置的值。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.append(&#39;Lind&#39;, [&#39;&lt;http://localhost&gt;&#39;, &#39;&lt;http://localhost:3000&gt;&#39;]);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.append(&#39;Set-Cookie&#39;, &#39;foo=bar;Path=/;HttpOnly&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.append(&#39;Warning&#39;, &#39;199 Miscellaneous warning&#39;);</span></span></code></pre></div><h4 id="res-attachment-filename" tabindex="-1">res.attachment([filename]) <a class="header-anchor" href="#res-attachment-filename" aria-label="Permalink to &quot;res.attachment([filename])&quot;">​</a></h4><p>设置 HTTP 响应的<code>Content-Disposition</code>头内容为 &quot;attachment&quot;。如果提供了<code>filename</code>，那么将通过<code>res.type()</code>获得扩展名来设置<code>Content-Type</code>，并且设置<code>Content-Disposition</code>内容为 &quot;filename=“parameter。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.attachment();</span></span>
<span class="line"><span style="color:#A6ACCD;">// Content-Disposition: attachment</span></span>
<span class="line"><span style="color:#A6ACCD;">res.attachment(&#39;path/to/logo.png&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">// Content-Disposition: attachment; file</span></span>
<span class="line"><span style="color:#A6ACCD;">// Content-Type: image/png</span></span></code></pre></div><h4 id="res-cookie-name-value-options" tabindex="-1">res.cookie(name, value [,options]) <a class="header-anchor" href="#res-cookie-name-value-options" aria-label="Permalink to &quot;res.cookie(name, value [,options])&quot;">​</a></h4><p>设置<code>name</code>和<code>value</code>的<code>cookie</code>，<code>value</code>参数可以是一串字符或者是转化为 json 字符串的对象。</p><blockquote><p>res.cookie() 所作的都是基于提供的<code>options</code>参数来设置<code>Set-Cookie</code>头部。没有指定任何的<code>options</code>，那么默认值在<code>RFC6265</code>中指定。</p></blockquote><p>使用实例：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.cookie(&#39;name&#39;, &#39;tobi&#39;, {&#39;domain&#39;:&#39;.example.com&#39;, &#39;path&#39;:&#39;/admin&#39;, &#39;secure&#39;:true});</span></span>
<span class="line"><span style="color:#A6ACCD;">res.cookie(&#39;remenberme&#39;, &#39;1&#39;, {&#39;expires&#39;:new Date(Date.now() + 90000), &#39;httpOnly&#39;:true});</span></span></code></pre></div><p><code>maxAge</code>是一个方便设置过期时间的方便的选项，其以当前时间开始的毫秒数来计算。下面的示例和上面的第二条功效一样。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.cookie(&#39;rememberme&#39;, &#39;1&#39;, {&#39;maxAge&#39;:90000}, &quot;httpOnly&quot;:true);</span></span></code></pre></div><p>你可以设置传递一个对象作为<code>value</code>的参数。然后其将被序列化为 Json 字符串，被<code>bodyParser()</code>中间件解析。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.cookie(&#39;cart&#39;, {&#39;items&#39;:[1, 2, 3]});</span></span>
<span class="line"><span style="color:#A6ACCD;">res.cookie(&#39;cart&#39;, {&#39;items&#39;:[1, 2, 3]}, {&#39;maxAge&#39;:90000});</span></span></code></pre></div><p>当我们使用<code>cookie-parser</code>中间件的时候，这个方法也支持签名的 cookie。简单地，在设置<code>options</code>时包含<code>signed</code>选项为<code>true</code>。然后<code>res.cookie()</code>将使用传递给<code>cookieParser(secret)</code>的密钥来签名这个值。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.cookie(&#39;name&#39;, &#39;tobi&#39;, {&#39;signed&#39;:true});</span></span></code></pre></div><h4 id="res-clearcookie-name-options" tabindex="-1">res.clearCookie(name [,options]) <a class="header-anchor" href="#res-clearcookie-name-options" aria-label="Permalink to &quot;res.clearCookie(name [,options])&quot;">​</a></h4><p>根据指定的<code>name</code>清除对应的 cookie。更多关于<code>options</code>对象可以查阅<code>res.cookie()</code>。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.cookie(&#39;name&#39;, &#39;tobi&#39;, {&#39;path&#39;:&#39;/admin&#39;});</span></span>
<span class="line"><span style="color:#A6ACCD;">res.clearCookie(&#39;name&#39;, {&#39;path&#39;:&#39;admin&#39;});</span></span></code></pre></div><h4 id="res-download-path-filename-fn" tabindex="-1">res.download(path, [,filename], [,fn]) <a class="header-anchor" href="#res-download-path-filename-fn" aria-label="Permalink to &quot;res.download(path, [,filename], [,fn])&quot;">​</a></h4><p>传输<code>path</code>指定文件作为一个附件。通常，浏览器提示用户下载。默认情况下，<code>Content-Disposition</code>头部 &quot;filename=“的参数为<code>path</code>(通常会出现在浏览器的对话框中)。通过指定<code>filename</code>参数来覆盖默认值。 当一个错误发生时或者传输完成，这个方法将调用<code>fn</code>指定的回调方法。这个方法使用<code>res.sendFile()</code>来传输文件。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">download</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/report-12345.pdf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">download</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/report-12345.pdf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">report.pdf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">download</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">report-12345.pdf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">report.pdf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Handle error, but keep in mind the response may be partially-sent</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// so check res.headersSent</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// decrement a download credit, etc.</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="res-end-data-encoding" tabindex="-1">res.end([data] [, encoding]) <a class="header-anchor" href="#res-end-data-encoding" aria-label="Permalink to &quot;res.end([data] [, encoding])&quot;">​</a></h4><p>结束本响应的过程。这个方法实际上来自<code>Node</code>核心模块，具体的是 <a href="https://nodejs.org/api/http.html#http_response_end_data_encoding_callback" target="_blank" rel="noreferrer">response.end() method of http.ServerResponse</a>。 用来快速结束请求，没有任何的数据。如果你需要发送数据，可以使用 <a href="http://expressjs.com/4x/api.html#res.send" target="_blank" rel="noreferrer">res.send()</a> 和 <a href="http://expressjs.com/4x/api.html#res.json" target="_blank" rel="noreferrer">res.json()</a> 这类的方法。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.end();</span></span>
<span class="line"><span style="color:#A6ACCD;">res.status(404).end();</span></span></code></pre></div><h4 id="res-format-object" tabindex="-1">res.format(object) <a class="header-anchor" href="#res-format-object" aria-label="Permalink to &quot;res.format(object)&quot;">​</a></h4><p>进行内容协商，根据请求的对象中<code>Accept</code>HTTP 头部指定的接受内容。它使用 <a href="http://expressjs.com/4x/api.html#res.accepts" target="_blank" rel="noreferrer">req.accepts()</a> 来选择一个句柄来为请求服务，这些句柄按质量值进行排序。如果这个头部没有指定，那么第一个方法默认被调用。当不匹配时，服务器将返回<code>406</code>“Not Acceptable”，或者调用<code>default</code>回调。 <code>Content-Type</code>请求头被设置，当一个回调方法被选择。然而你可以改变他，在这个方法中使用这些方法，比如<code>res.set()</code>或者<code>res.type()</code>。 下面的例子，将回复<code>{&quot;message&quot;:&quot;hey&quot;}</code>，当请求的对象中<code>Accept</code>头部设置成 &quot;application/json&quot; 或者”*/json”(不过如果是<code>*/*</code>，然后这个回复就是 &quot;hey&quot;)。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">format</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">text/plain</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hey</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">text/html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;p&gt;hey&lt;/p&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">application/json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">message</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hey</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">default</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">406</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Not Acceptable</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>除了规范化的 MIME 类型之外，你也可以使用拓展名来映射这些类型来避免冗长的实现：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">format</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hey</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">html</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;p&gt;hey&lt;/p&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">json</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">message</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hey</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h4 id="res-get-field" tabindex="-1">res.get(field) <a class="header-anchor" href="#res-get-field" aria-label="Permalink to &quot;res.get(field)&quot;">​</a></h4><p>返回<code>field</code>指定的 HTTP 响应的头部。匹配是区分大小写。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// =&gt; &quot;text/plain&quot;</span></span></code></pre></div><h4 id="res-json-body" tabindex="-1">res.json([body]) <a class="header-anchor" href="#res-json-body" aria-label="Permalink to &quot;res.json([body])&quot;">​</a></h4><p>发送一个 json 的响应。这个方法和将一个对象或者一个数组作为参数传递给<code>res.send()</code>方法的效果相同。不过，你可以使用这个方法来转换其他的值到 json，例如<code>null</code>，<code>undefined</code>。(虽然这些都是技术上无效的 JSON)。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.json(null);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.json({user:&#39;tobi&#39;});</span></span>
<span class="line"><span style="color:#A6ACCD;">res.status(500).json({error:&#39;message&#39;});</span></span></code></pre></div><h4 id="res-jsonp-body" tabindex="-1">res.jsonp([body]) <a class="header-anchor" href="#res-jsonp-body" aria-label="Permalink to &quot;res.jsonp([body])&quot;">​</a></h4><p>发送一个 json 的响应，并且支持 JSONP。这个方法和<code>res.json()</code>效果相同，除了其在选项中支持 JSONP 回调。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.jsonp(null)</span></span>
<span class="line"><span style="color:#A6ACCD;">// =&gt; null</span></span>
<span class="line"><span style="color:#A6ACCD;">res.jsonp({user:&#39;tobi&#39;})</span></span>
<span class="line"><span style="color:#A6ACCD;">// =&gt; {&quot;user&quot; : &quot;tobi&quot;}</span></span>
<span class="line"><span style="color:#A6ACCD;">res.status(500).jsonp({error:&#39;message&#39;})</span></span>
<span class="line"><span style="color:#A6ACCD;"> // =&gt; {&quot;error&quot; : &quot;message&quot;}</span></span></code></pre></div><p>默认情况下，jsonp 的回调方法简单写作<code>callback</code>。可以通过 <a href="http://expressjs.com/4x/api.html#app.settings.table" target="_blank" rel="noreferrer">jsonp callback name</a> 设置来重写它。 下面是一些例子使用 JSONP 响应，使用相同的代码:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// ?callback=foo</span></span>
<span class="line"><span style="color:#A6ACCD;">res.jsonp({user:&#39;tobo&#39;})</span></span>
<span class="line"><span style="color:#A6ACCD;">// =&gt; foo({&quot;user&quot;:&quot;tobi&quot;})</span></span>
<span class="line"><span style="color:#A6ACCD;">app.set(&#39;jsonp callback name&#39;, &#39;cb&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">// ?cb=foo</span></span>
<span class="line"><span style="color:#A6ACCD;">res.status(500).jsonp({error:&#39;message&#39;})</span></span>
<span class="line"><span style="color:#A6ACCD;">// =&gt; foo({&quot;error&quot;:&quot;message&quot;})</span></span></code></pre></div><h4 id="res-links-links" tabindex="-1">res.links(links) <a class="header-anchor" href="#res-links-links" aria-label="Permalink to &quot;res.links(links)&quot;">​</a></h4><p>连接这些<code>links</code>，<code>links</code>是以传入参数的属性形式提供，连接之后的内容用来填充响应的 Link HTTP 头部。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.links({</span></span>
<span class="line"><span style="color:#A6ACCD;">    next:&#39;http://api.example.com/users?page=2&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    last:&#39;http://api.example.com/user?page=5&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><p>效果：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Link:&lt;http://api.example.com/users?page=2&gt;;rel=&quot;next&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;http://api.example.com/users?page=5&gt;;rel=&quot;last&quot;</span></span></code></pre></div><h4 id="res-location-path" tabindex="-1">res.location(path) <a class="header-anchor" href="#res-location-path" aria-label="Permalink to &quot;res.location(path)&quot;">​</a></h4><p>设置响应的<code>Location</code>HTTP 头部为指定的<code>path</code>参数。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.location(&#39;/foo/bar&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.location(&#39;http://example.com&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.location(&#39;back&#39;);</span></span></code></pre></div><p>当<code>path</code>参数为<code>back</code>时，其具有特殊的意义，其指定 URL 为请求对象的<code>Referer</code>头部指定的 URL。如果请求中没有指定，那么其即为 &quot;/&quot;。</p><blockquote><p>Express 传递指定的 URL 字符串作为回复给浏览器响应中的<code>Location</code>头部的值，不检测和操作，除了<code>back</code>这个参数。浏览器会将用户重定向到<code>location</code>设置的 url 或者<code>Referer</code>的 url（<code>back</code>参数的情况）</p></blockquote><h4 id="res-redirect-status-path" tabindex="-1">res.redirect([status,] path) <a class="header-anchor" href="#res-redirect-status-path" aria-label="Permalink to &quot;res.redirect([status,] path)&quot;">​</a></h4><p>重定向来源于指定<code>path</code>的 URL，以及指定的 <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank" rel="noreferrer">HTTP status code</a><code>status</code>。如果你没有指定<code>status</code>，status code 默认为 &quot;302 Found&quot;。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.redirect(&#39;/foo/bar&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.redirect(&#39;http://example.com&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.redirect(301, &#39;http://example.com&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.redirect(&#39;../login&#39;);</span></span></code></pre></div><p>重定向也可以是完整的 URL，来重定向到不同的站点。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.redirect(&#39;http://google.com&#39;);</span></span></code></pre></div><p>重定向也可以相对于主机的根路径。比如，如果程序的路径为<code>http://example.com/admin/post/new</code>，那么下面将重定向到<code>http://example.com/admim</code>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.redirect(&#39;/admin&#39;);</span></span></code></pre></div><p>重定向也可以相对于当前的 URL。比如，来之于<code>http://example.com/blog/admin/</code>(注意结尾的<code>/</code>)，下面将重定向到<code>http://example.com/blog/admin/post/new</code>。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.redirect(&#39;post/new&#39;);</span></span></code></pre></div><p>如果来至于<code>http://example.com/blog/admin</code>（没有尾部<code>/</code>），重定向<code>post/new</code>，将重定向到<code>http://example.com/blog/post/new</code>。如果你觉得上面很混乱，可以把路径段认为目录 (有&#39;/&#39;) 或者文件，这样是可以的。相对路径的重定向也是可以的。如果你当前的路径为<code>http://example.com/admin/post/new</code>，下面的操作将重定向到<code>http://example.com/admin/post</code>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.redirect(&#39;..&#39;);</span></span></code></pre></div><p><code>back</code>将重定向请求到 <a href="http://en.wikipedia.org/wiki/HTTP_referer" target="_blank" rel="noreferrer">referer</a>，当没有<code>referer</code>的时候，默认为<code>/</code>。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.redirect(&#39;back&#39;);</span></span></code></pre></div><h4 id="res-render-view-locals-callback" tabindex="-1">res.render(view [, locals] [, callback]) <a class="header-anchor" href="#res-render-view-locals-callback" aria-label="Permalink to &quot;res.render(view [, locals] [, callback])&quot;">​</a></h4><p>渲染一个视图，然后将渲染得到的 HTML 文档发送给客户端。可选的参数为:</p><ul><li><code>locals</code>，定义了视图本地参数属性的一个对象。</li><li><code>callback</code>，一个回调方法。如果提供了这个参数，<code>render</code>方法将返回错误和渲染之后的模板，并且不自动发送响应。当有错误发生时，可以在这个回调内部，调用<code>next(err)</code>方法。</li></ul><blockquote><p>本地变量缓存使能视图缓存。在开发环境中缓存视图，需要手动设置为 true；视图缓存在生产环境中默认开启。</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// send the rendered view to the client</span></span>
<span class="line"><span style="color:#A6ACCD;">res.render(&#39;index&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">// if a callback is specified, the render HTML string has to be sent explicitly</span></span>
<span class="line"><span style="color:#A6ACCD;">res.render(&#39;index&#39;, function(err, html) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.send(html);</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">// pass a local variable to  the view</span></span>
<span class="line"><span style="color:#A6ACCD;">res.render(&#39;user&#39;, {name:&#39;Tobi&#39;}, function(err, html) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // ...</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><h4 id="res-send-body" tabindex="-1">res.send([body]) <a class="header-anchor" href="#res-send-body" aria-label="Permalink to &quot;res.send([body])&quot;">​</a></h4><p>发送 HTTP 响应。 <code>body</code>参数可以是一个<code>Buffer</code>对象，一个字符串，一个对象，或者一个数组。比如：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.send(new Buffer(&#39;whoop&#39;));</span></span>
<span class="line"><span style="color:#A6ACCD;">res.send({some:&#39;json&#39;});</span></span>
<span class="line"><span style="color:#A6ACCD;">res.send(&#39;&lt;p&gt;some html&lt;/p&gt;&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.status(404).send(&#39;Sorry, we cannot find that!&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.status(500).send({ error: &#39;something blew up&#39; });</span></span></code></pre></div><p>对于一般的非流请求，这个方法可以执行许多有用的的任务：比如，它自动给<code>Content-Length</code>HTTP 响应头赋值 (除非先前定义)，也支持自动的 HEAD 和 HTTP 缓存更新。 当参数是一个<code>Buffer</code>对象，这个方法设置<code>Content-Type</code>响应头为<code>application/octet-stream</code>，除非事先提供，如下所示:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.set(&#39;Content-Type&#39;, &#39;text/html&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.send(new Buffer(&#39;&lt;p&gt;some html&lt;/p&gt;&#39;));</span></span></code></pre></div><p>当参数是一个字符串，这个方法设置<code>Content-Type</code>响应头为<code>text/html</code>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.send(&#39;&lt;p&gt;some html&lt;/p&gt;&#39;);</span></span></code></pre></div><p>当参数是一个对象或者数组，Express 使用 JSON 格式来表示：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.send({user:&#39;tobi&#39;});</span></span>
<span class="line"><span style="color:#A6ACCD;">res.send([1, 2, 3]);</span></span></code></pre></div><h4 id="res-sendfile-path-options-fn" tabindex="-1">res.sendFile(path [, options] [, fn]) <a class="header-anchor" href="#res-sendfile-path-options-fn" aria-label="Permalink to &quot;res.sendFile(path [, options] [, fn])&quot;">​</a></h4><blockquote><p><code>res.sendFile()</code>从<code>Express v4.8.0</code>开始支持。</p></blockquote><p>传输<code>path</code>指定的文件。根据文件的扩展名设置<code>Content-Type</code>HTTP 头部。除非在<code>options</code>中有关于<code>root</code>的设置，<code>path</code>一定是关于文件的绝对路径。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app.get(&#39;/file/:name&#39;, function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    var options = {</span></span>
<span class="line"><span style="color:#A6ACCD;">        root:__dirname + &#39;/public&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">        dotfile:&#39;deny&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">        headers:{</span></span>
<span class="line"><span style="color:#A6ACCD;">            &#39;x-timestamp&#39;:Date.now(),</span></span>
<span class="line"><span style="color:#A6ACCD;">            &#39;x-sent&#39;:true</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    };</span></span>
<span class="line"><span style="color:#A6ACCD;">    var fileName = req.params.name;</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.sendFile(fileName, options, function(err) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        if (err) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            console.log(err);</span></span>
<span class="line"><span style="color:#A6ACCD;">            res.status(err.status).end();</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        else {</span></span>
<span class="line"><span style="color:#A6ACCD;">            console.log(&#39;sent&#39;, fileName);</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    });</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><p><code>res.sendFile</code>提供了文件服务的细粒度支持，如下例子说明：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app.get(&#39;/user/:uid/photos/:file&#39;, function(req, res) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    var uid = req.params.uid</span></span>
<span class="line"><span style="color:#A6ACCD;">        , file = req.params.file;</span></span>
<span class="line"><span style="color:#A6ACCD;">    req.user.mayViewFilesFrom(uid, function(yes) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        if (yes) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            res.sendFile(&#39;/upload/&#39; + uid + &#39;/&#39; + file);</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        else {</span></span>
<span class="line"><span style="color:#A6ACCD;">            res.status(403).send(&#39;Sorry! you cant see that.&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    });</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span></code></pre></div><p>获取更多信息，或者你有问题或者关注，可以查阅 <a href="https://github.com/pillarjs/send" target="_blank" rel="noreferrer">send</a>。</p><h4 id="res-sendstatus-statuscode" tabindex="-1">res.sendStatus(statusCode) <a class="header-anchor" href="#res-sendstatus-statuscode" aria-label="Permalink to &quot;res.sendStatus(statusCode)&quot;">​</a></h4><p>设置响应对象的<code>HTTP status code</code>为<code>statusCode</code>并且发送<code>statusCode</code>的相应的字符串形式作为响应的 Body。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.sendStatus(200); // equivalent to res.status(200).send(&#39;OK&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.sendStatus(403); // equivalent to res.status(403).send(&#39;Forbidden&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.sendStatus(404); // equivalent to res.status(404).send(&#39;Not Found&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.sendStatus(500); // equivalent to res.status(500).send(&#39;Internal Server Error&#39;)</span></span></code></pre></div><p>如果一个不支持的状态被指定，这个 HTTP status 依然被设置为<code>statusCode</code>并且用这个 code 的字符串作为 Body。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.sendStatus(2000); // equivalent to res.status(2000).send(&#39;2000&#39;);</span></span></code></pre></div><p><a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes" target="_blank" rel="noreferrer">More about HTTP Status Codes</a></p><h4 id="res-set-field-value" tabindex="-1">res.set(field [, value]) <a class="header-anchor" href="#res-set-field-value" aria-label="Permalink to &quot;res.set(field [, value])&quot;">​</a></h4><p>设置响应对象的 HTTP 头部<code>field</code>为<code>value</code>。为了一次设置多个值，那么可以传递一个对象为参数。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.set(&#39;Content-Type&#39;, &#39;text/plain&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.set({</span></span>
<span class="line"><span style="color:#A6ACCD;">    &#39;Content-Type&#39;:&#39;text/plain&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    &#39;Content-Length&#39;:&#39;123&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    &#39;ETag&#39;:&#39;123456&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span></code></pre></div><p>其和<code>res.header(field [,value])</code>效果一致。</p><h4 id="res-status-code" tabindex="-1">res.status(code) <a class="header-anchor" href="#res-status-code" aria-label="Permalink to &quot;res.status(code)&quot;">​</a></h4><p>使用这个方法来设置响应对象的 HTTP status。其是 Node 中 <a href="http://nodejs.org/api/http.html#http_response_statuscode" target="_blank" rel="noreferrer">response.statusCode</a> 的一个连贯性的别名。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.status(403).end();</span></span>
<span class="line"><span style="color:#A6ACCD;">res.status(400).send(&#39;Bad Request&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">res.status(404).sendFile(&#39;/absolute/path/to/404.png&#39;);</span></span></code></pre></div><h4 id="res-type-type" tabindex="-1">res.type(type) <a class="header-anchor" href="#res-type-type" aria-label="Permalink to &quot;res.type(type)&quot;">​</a></h4><p>程序将设置<code>Content-Type</code>HTTP 头部的 MIME type，如果这个设置的<code>type</code>能够被 <a href="https://github.com/broofa/node-mime" target="_blank" rel="noreferrer">mime.lookup</a> 解析成正确的<code>Content-Type</code>。如果<code>type</code>中包含了<code>/</code>字符，那么程序会直接设置<code>Content-Type</code>为<code>type</code>。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.type(&#39;.html&#39;);              // =&gt; &#39;text/html&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">res.type(&#39;html&#39;);               // =&gt; &#39;text/html&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">res.type(&#39;json&#39;);               // =&gt; &#39;application/json&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">res.type(&#39;application/json&#39;);   // =&gt; &#39;application/json&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">res.type(&#39;png&#39;);                // =&gt; image/png:</span></span></code></pre></div><h4 id="res-vary-field" tabindex="-1">res.vary(field) <a class="header-anchor" href="#res-vary-field" aria-label="Permalink to &quot;res.vary(field)&quot;">​</a></h4><p>在没有 Vary 应答头部时增加 Vary 应答头部。</p><blockquote><p>ps：vary 的意义在于告诉代理服务器 / 缓存 / CDN，如何判断请求是否一样，vary 中的组合就是服务器 / 缓存 / CDN 判断的依据，比如 Vary 中有 User-Agent，那么即使相同的请求，如果用户使用 IE 打开了一个页面，再用 Firefox 打开这个页面的时候，CDN / 代理会认为是不同的页面，如果 Vary 中没有 User-Agent，那么 CDN / 代理会认为是相同的页面，直接给用户返回缓存的页面，而不会再去 web 服务器请求相应的页面。通俗的说就相当于<code>field</code>作为了一个缓存的 key 来判断是否命中缓存</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">res.vary(&#39;User-Agent&#39;).render(&#39;docs&#39;);</span></span></code></pre></div><h2 id="router" tabindex="-1">Router <a class="header-anchor" href="#router" aria-label="Permalink to &quot;Router&quot;">​</a></h2><p>一个<code>router</code>对象是一个单独的实例关于中间件和路由。你可以认为其是一个 &quot;mini-application&quot;（迷你程序），其具有操作中间件和路由方法的能力。每个<code>Express</code>程序有一个内建的 app 路由。 路由自身表现为一个中间件，所以你可以使用它作为<code>app.use()</code>方法的一个参数或者作为另一个路由的<code>use()</code>的参数。 顶层的<code>express</code>对象有一个<code>Router()</code>方法，你可以使用<code>Router()</code>来创建一个新的<code>router</code>对象。</p><h3 id="router-options" tabindex="-1">Router([options]) <a class="header-anchor" href="#router-options" aria-label="Permalink to &quot;Router([options])&quot;">​</a></h3><p>如下，可以创建一个路由：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">var router = express.Router([options]);</span></span></code></pre></div><p>你可以将<code>router</code>当作一个程序，可以在其上添加中间件和 HTTP 路由方法 (例如<code>get</code>，<code>put</code>，<code>post</code>等等)。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// invoked for any requests passed to this router</span></span>
<span class="line"><span style="color:#A6ACCD;">router.use(function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  // .. some logic here .. like any other middleware</span></span>
<span class="line"><span style="color:#A6ACCD;">  next();</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">// will handle any request that ends in /events</span></span>
<span class="line"><span style="color:#A6ACCD;">// depends on where the router is &quot;use()&#39;d&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">router.get(&#39;/events&#39;, function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  // ..</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><p>你可以在一个特别的根 URL 上挂载一个路由，这样你就以将你的各个路由放到不同的文件中或者甚至是 mini 的程序。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// only requests to /calendar/* will be sent to our &quot;router&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">app.use(&#39;/calendar&#39;, router);</span></span></code></pre></div><h3 id="methods-4" tabindex="-1">Methods <a class="header-anchor" href="#methods-4" aria-label="Permalink to &quot;Methods&quot;">​</a></h3><h4 id="router-all-path-callback-callback" tabindex="-1">router.all(path, [callback, …] callback) <a class="header-anchor" href="#router-all-path-callback-callback" aria-label="Permalink to &quot;router.all(path, [callback, …] callback)&quot;">​</a></h4><p>这个方法和<code>router.METHOD()</code>方法一样，除了这个方法会匹配所有的 HTTP 动作。 这个方法对想映射全局的逻辑处理到特殊的路径前缀或者任意匹配是十分有用的。比如，如果你放置下面所示的这个路由在其他路由的前面，那么其将要求从这个点开始的所有的路由进行验证操作和自动加载用户信息。记住，这些全局的逻辑操作，不需要结束请求响应周期：<code>loaduser</code>可以执行一个任务，然后调用<code>next()</code>来将执行流程移交到随后的路由。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">router.all(&#39;*&#39;, requireAuthentication, loadUser);</span></span></code></pre></div><p>相等的形式:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">router.all(&#39;*&#39;, requireAuthentication)</span></span>
<span class="line"><span style="color:#A6ACCD;">router.all(&#39;*&#39;, loadUser);</span></span></code></pre></div><p>这是一个白名单全局功能的例子。这个例子很像前面的，不过其仅仅作用于以<code>/api</code>开头的路径:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">router.all(&#39;/api/*&#39;, requireAuthentication);</span></span></code></pre></div><h4 id="router-method-path-callback-callback" tabindex="-1">router.METHOD(path, [callback, …] callback) <a class="header-anchor" href="#router-method-path-callback-callback" aria-label="Permalink to &quot;router.METHOD(path, [callback, …] callback)&quot;">​</a></h4><p><code>router.METHOD()</code>方法提供了路由方法在<code>Express</code>中，这里的<code>METHOD</code>是 HTTP 方法中的一个，比如<code>GET</code>，<code>PUT</code>，<code>POST</code>等等，但<code>router</code>中的 METHOD 是小写的。所以，实际的方法是<code>router.get()</code>，<code>router.put()</code>，<code>router.post()</code>等等。 你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果请求没有满足当前路由的处理条件，那么传递控制到随后的路由。 下面的片段可能说明了最简单的路由定义。Experss 转换 path 字符串为正则表达式，用于内部匹配传入的请求。在匹配的时候，是不考虑<code>Query strings</code>，例如，“GET /“将匹配下面的路由，“GET /? 也是一样的。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">router.get(&#39;/&#39;, function(req, res) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.send(&#39;Hello World&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><p>如果你对匹配的 path 有特殊的限制，你可以使用正则表达式，例如，下面的可以匹配 &quot;GET /commits/71dbb9c&quot; 和 &quot;GET /commits/71bb92..4c084f9”。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">router.get(/^\/commits\/(\w+)(?:\.\.(\w+))?$/, function(req, res) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    var from = req.params[0];</span></span>
<span class="line"><span style="color:#A6ACCD;">    var to = req.params[1];</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.send(&#39;commit range &#39; + from + &#39;..&#39; + to);</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><h4 id="router-param-name-callback" tabindex="-1">router.param(name, callback) <a class="header-anchor" href="#router-param-name-callback" aria-label="Permalink to &quot;router.param(name, callback)&quot;">​</a></h4><p>给路由参数添加回调触发器，这里的<code>name</code>是参数名，<code>function</code>是回调方法。回调方法的参数按序是请求对象，响应对象，下个中间件，参数值和参数名。虽然<code>name</code>在技术上是可选的，但是自 Express V4.11.0 之后版本不推荐使用 (见下面)。</p><blockquote><p>不像<code>app.param()</code>，<code>router.param()</code>不接受一个数组作为路由参数。</p></blockquote><p>例如，当<code>:user</code>出现在路由路径中，你可以映射用户加载的逻辑处理来自动提供<code>req.user</code>给这个路由，或者对输入的参数进行验证。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">router.param(&#39;user&#39;, function(req, res, next, id) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        User.find(id, function(error, user) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            if (err) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                next(err);</span></span>
<span class="line"><span style="color:#A6ACCD;">            }</span></span>
<span class="line"><span style="color:#A6ACCD;">            else if (user){</span></span>
<span class="line"><span style="color:#A6ACCD;">                req.user = user;</span></span>
<span class="line"><span style="color:#A6ACCD;">            } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">                next(new Error(&#39;failed to load user&#39;));</span></span>
<span class="line"><span style="color:#A6ACCD;">            }</span></span>
<span class="line"><span style="color:#A6ACCD;">        });</span></span>
<span class="line"><span style="color:#A6ACCD;">    });</span></span></code></pre></div><p>对于<code>Param</code>的回调定义的路由来说，他们是局部的。它们不会被挂载的 app 或者路由继承。所以，定义在<code>router</code>上的<code>param</code>回调只有是在<code>router</code>上的路由具有这个路由参数时才起作用。 在定义<code>param</code>的路由上，<code>param</code>回调都是第一个被调用的，它们在一个请求 - 响应循环中都会被调用一次并且只有一次，即使多个路由都匹配，如下面的例子：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">router.param(&#39;id&#39;, function(req, res, next, id) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    console.log(&#39;CALLED ONLY ONCE&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    next();</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">router.get(&#39;/user/:id&#39;, function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    console.log(&#39;although this matches&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    next();</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">router.get(&#39;/user/:id&#39;, function(req, res) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    console.log(&#39;and this mathces too&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.end();</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><p>当<code>GET /user/42</code>，得到下面的结果:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">CALLED ONLY ONCE</span></span>
<span class="line"><span style="color:#A6ACCD;">    although this matches</span></span>
<span class="line"><span style="color:#A6ACCD;">    and this matches too</span></span></code></pre></div><p>`</p><blockquote><p>下面章节描述的<code>router.param(callback)</code>在 v4.11.0 之后被弃用。</p></blockquote><p>通过只传递一个回调参数给<code>router.param(name, callback)</code>方法，<code>router.param(naem, callback)</code>方法的行为将被完全改变。这个回调参数是关于<code>router.param(name, callback)</code>该具有怎样的行为的一个自定义方法，这个方法必须接受两个参数并且返回一个中间件。 这个回调的第一个参数就是需要捕获的 url 的参数名，第二个参数可以是任一的 JavaScript 对象，其可能在实现返回一个中间件时被使用。 这个回调方法返回的中间件决定了当 URL 中包含这个参数时所采取的行为。 在下面的例子中，<code>router.param(name, callback)</code>参数签名被修改成了<code>router.param(name, accessId)</code>。替换接受一个参数名和回调，<code>router.param()</code>现在接受一个参数名和一个数字。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">var express = require(&#39;express&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">var app = express();</span></span>
<span class="line"><span style="color:#A6ACCD;">var router = express.Router();</span></span>
<span class="line"><span style="color:#A6ACCD;">router.param(function(param, option){</span></span>
<span class="line"><span style="color:#A6ACCD;">    return function(req, res, next, val) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        if (val == option) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            next();</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        else {</span></span>
<span class="line"><span style="color:#A6ACCD;">            res.sendStatus(403);</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">router.param(&#39;id&#39;, 1337);</span></span>
<span class="line"><span style="color:#A6ACCD;">router.get(&#39;/user/:id&#39;, function(req, res) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.send(&#39;Ok&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">app.use(router);</span></span>
<span class="line"><span style="color:#A6ACCD;">app.listen(3000, function() {</span></span>
<span class="line"><span style="color:#A6ACCD;">    console.log(&#39;Ready&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><p>在这个例子中，<code>router.param(name. callback)</code>参数签名保持和原来一样，但是替换成了一个中间件，定义了一个自定义的数据类型检测方法来检测<code>user id</code>的类型正确性。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">router.param(function(param, validator) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return function(req, res, next, val) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        if (validator(val)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            next();</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        else {</span></span>
<span class="line"><span style="color:#A6ACCD;">            res.sendStatus(403);</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">router.param(&#39;id&#39;, function(candidate) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return !isNaN(parseFloat(candidate)) &amp;&amp; isFinite(candidate);</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><h4 id="router-route-path" tabindex="-1">router.route(path) <a class="header-anchor" href="#router-route-path" aria-label="Permalink to &quot;router.route(path)&quot;">​</a></h4><p>返回一个单例模式的路由的实例，之后你可以在其上施加各种 HTTP 动作的中间件。使用<code>router.route()</code>来避免重复路由名字 (例如错字错误)–说的意思应该是使用<code>router.route()</code>这个单例方法来避免同一个路径多个路由实例。</p><p>构建在上面的<code>router.param()</code>例子之上，下面的代码展示了怎么使用<code>router.route()</code>来指定各种 HTTP 方法的处理句柄。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">var router = express.Router();</span></span>
<span class="line"><span style="color:#A6ACCD;">router.param(&#39;user_id&#39;, function(req, res, next, id) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // sample user, would actually fetch from DB, etc...</span></span>
<span class="line"><span style="color:#A6ACCD;">    req.user = {</span></span>
<span class="line"><span style="color:#A6ACCD;">        id:id,</span></span>
<span class="line"><span style="color:#A6ACCD;">        name:&quot;TJ&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    };</span></span>
<span class="line"><span style="color:#A6ACCD;">    next();</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">router.route(&#39;/users/:user_id&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    .all(function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        // runs for all HTTP verbs first</span></span>
<span class="line"><span style="color:#A6ACCD;">        // think of it as route specific middleware!</span></span>
<span class="line"><span style="color:#A6ACCD;">        next();</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">    .get(function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        res.json(req.user);</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">    .put(function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        // just an example of maybe updating the user</span></span>
<span class="line"><span style="color:#A6ACCD;">        req.user.name = req.params.name;</span></span>
<span class="line"><span style="color:#A6ACCD;">        // save user ... etc</span></span>
<span class="line"><span style="color:#A6ACCD;">        res.json(req.user);</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">    .post(function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        next(new Error(&#39;not implemented&#39;));</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">    .delete(function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        next(new Error(&#39;not implemented&#39;));</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span></code></pre></div><p>这种方法重复使用单个<code>/usrs/:user_id</code>路径来添加了各种的 HTTP 方法。</p><h4 id="router-use-path-function-function" tabindex="-1">router.use([path], [function, …] function) <a class="header-anchor" href="#router-use-path-function-function" aria-label="Permalink to &quot;router.use([path], [function, …] function)&quot;">​</a></h4><p>给可选的<code>path</code>参数指定的路径挂载给定的中间件方法，未指定<code>path</code>参数，默认值为<code>/</code>。 这个方法类似于<code>app.use()</code>。一个简单的例子和用例在下面描述。查阅 <a href="http://expressjs.com/en/4x/api.html#app.use" target="_blank" rel="noreferrer">app.use()</a> 获得更多的信息。 中间件就像一个水暖管道，请求在你定义的第一个中间件处开始，顺着中间件堆栈一路往下，如果路径匹配则处理这个请求。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">var express = require(&#39;express&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">var app = express();</span></span>
<span class="line"><span style="color:#A6ACCD;">var router = express.Router();</span></span>
<span class="line"><span style="color:#A6ACCD;">// simple logger for this router`s requests</span></span>
<span class="line"><span style="color:#A6ACCD;">// all requests to this router will first hit this middleware</span></span>
<span class="line"><span style="color:#A6ACCD;">router.use(function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    console.log(&#39;%s %s %s&#39;, req.method, req.url, req.path);</span></span>
<span class="line"><span style="color:#A6ACCD;">    next();</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">// this will only be invoked if the path starts with /bar form the mount ponit</span></span>
<span class="line"><span style="color:#A6ACCD;">router.use(&#39;/bar&#39;, function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // ... maybe some additional /bar logging ...</span></span>
<span class="line"><span style="color:#A6ACCD;">    next();</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">// always be invoked</span></span>
<span class="line"><span style="color:#A6ACCD;">router.use(function(req, res, next) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.send(&#39;hello world&#39;)；</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">app.use(&#39;/foo&#39;, router);</span></span>
<span class="line"><span style="color:#A6ACCD;">app.listen(3000);</span></span></code></pre></div><p>对于中间件<code>function</code>，挂载的路径是被剥离的和不可见的。关于这个特性主要的影响是对于不同的路径，挂载相同的中间件可能对代码不做改动，尽管其前缀已经改变。 你使用<code>router.use()</code>定义中间件的顺序很重要。中间们是按序被调用的，所以顺序决定了中间件的优先级。例如，通常日志是你将使用的第一个中间件，以便每一个请求都被记录。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">var logger = require(&#39;morgan&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">router.use(logger());</span></span>
<span class="line"><span style="color:#A6ACCD;">router.use(express.static(__dirname + &#39;/public&#39;));</span></span>
<span class="line"><span style="color:#A6ACCD;">router.use(function(req, res) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.send(&#39;Hello&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><p>现在为了支持你不希望记录静态文件请求，但为了继续记录那些定义在<code>logger()</code>之后的路由和中间件。你可以简单的将<code>static()</code>移动到前面来解决：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">router.use(express.static(__dirname + &#39;/public&#39;));</span></span>
<span class="line"><span style="color:#A6ACCD;">router.use(logger());</span></span>
<span class="line"><span style="color:#A6ACCD;">router.use(function(req, res){</span></span>
<span class="line"><span style="color:#A6ACCD;">  res.send(&#39;Hello&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><p>另外一个确凿的例子是从不同的路径托管静态文件，你可以将<code>./public</code>放到前面来获得更高的优先级:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app.use(express.static(__dirname + &#39;/public&#39;));</span></span>
<span class="line"><span style="color:#A6ACCD;">app.use(express.static(__dirname + &#39;/files&#39;));</span></span>
<span class="line"><span style="color:#A6ACCD;">app.use(express.static(__dirname + &#39;/uploads&#39;));</span></span></code></pre></div><p><code>router.use()</code>方法也支持命名参数，以便你的挂载点对于其他的路由而言，可以使用命名参数来进行预加载，这样做是很有益的。</p></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-37656e44><!--[--><!--]--><div class="edit-info" data-v-37656e44><!----><div class="last-updated" data-v-37656e44><p class="VPLastUpdated" data-v-37656e44 data-v-149a99df>Updated at: <time datetime="2023-08-03T14:42:17.000Z" data-v-149a99df></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about_index.md\":\"e45a0e91\",\"about_todo.md\":\"cf7a1d2c\",\"front_basic_05 javascript语言零碎.md\":\"440584ac\",\"front_basic_html_css_html_css查缺知识点.md\":\"9f7203ce\",\"front_basic_typescript_typescript尝试入门.md\":\"b82e815b\",\"front_basic_手写代码系列_cookie与storage实现验证登录.md\":\"2f47f75a\",\"front_basic_04 正则表达式简要.md\":\"fca96c98\",\"front_basic_html_css_css-snippets.md\":\"3aa2d574\",\"front_basic_手写代码系列_axios与http请求封装.md\":\"ec886183\",\"front_basic_el-table使用技巧.md\":\"bb06b3a0\",\"front_basic_js ajax.md\":\"b2e90884\",\"front_basic_index.md\":\"18398821\",\"front_basic_html_css_html__css面试问题.md\":\"2fc63916\",\"front_basic_jquery.md\":\"f71acd35\",\"front_basic_二维码识别.md\":\"c932580f\",\"front_basic_jsp.md\":\"aa6e4c6f\",\"front_basic_javascript面试问题.md\":\"84d2095f\",\"front_basic_历史开发报错收集.md\":\"5b773a22\",\"front_basic_手写代码系列_数组去重.md\":\"27702166\",\"front_basic_手写代码系列_华为机试.md\":\"6f59ccfc\",\"front_basic_跨域请求cors.md\":\"13c3438b\",\"front_engineering_css 实现字体发光效果.md\":\"8f38a579\",\"front_basic_01 javascript语言基础上.md\":\"6f85221e\",\"front_basic_element-resize-detector监听页面元素.md\":\"408a2bab\",\"front_engineering_goumai.md\":\"25f84b55\",\"front_engineering_index.md\":\"0702e4f5\",\"front_engineering_pnpm 常用命令.md\":\"427deba5\",\"front_engineering_rquire.context使用.md\":\"f877aa81\",\"front_engineering_前端开发路径.md\":\"22b24d99\",\"front_engineering_开发规范.md\":\"82666443\",\"front_engineering_性能优化.md\":\"5fac7326\",\"front_engineering_简要约定式提交.md\":\"f5ed80c9\",\"front_frame_index.md\":\"75880155\",\"front_frame_react_一些react技巧.md\":\"13d1d9ae\",\"front_frame_vue_echarts-封装3d柱状图.md\":\"0c7bd7e6\",\"front_frame_vue_three.js入门.md\":\"482c36f8\",\"front_frame_vue_uni-app请求封装与拦截.md\":\"e9cca5eb\",\"front_frame_vue_vue中封装echarts柱形图.md\":\"e034c91a\",\"front_frame_vue_vue-element-admin框架学习.md\":\"ab6d2e9f\",\"front_frame_vue_vue中祖孙组件通信方法.md\":\"0f752e58\",\"front_frame_vue_打印属性及方法.md\":\"85841393\",\"front_node_express.md\":\"716a8cce\",\"front_node_index.md\":\"7ed56f4b\",\"guide_api-examples.md\":\"3f591e3e\",\"guide_markdown-examples.md\":\"295289b8\",\"index.md\":\"5a30f166\",\"library_photos_index.md\":\"c93612a2\",\"library_reading_亲密关系.md\":\"b5a06a48\",\"library_reading_在同一台电脑上配置多个ssh key.md\":\"520a73eb\",\"library_reading_外包公司.md\":\"2598744e\",\"library_reading_抽血常见问与答.md\":\"8b1268f8\",\"library_reading_英文请对方再说一次.md\":\"aa70c56a\",\"library_reading_英语.md\":\"551a241a\",\"library_videos_index.md\":\"af27ab43\",\"tech_arithmetic_leetcode_刷题.md\":\"db7d8dc5\",\"tech_arithmetic_index.md\":\"bf119e29\",\"tech_arithmetic_抽稀算法.md\":\"df2d3c83\",\"tech_designpattern_index.md\":\"6a2bb3e0\",\"tech_otherside_electron学习笔记.md\":\"df2a3d84\",\"tech_otherside_index.md\":\"4e2090eb\",\"tech_otherside_python.md\":\"b0f64760\",\"front_basic_手写代码系列_在页面上签名保存.md\":\"a0da103e\",\"library_reading_blog计划.md\":\"ad31bd2e\",\"library_reading_index.md\":\"5637d4ac\",\"front_engineering_webpack_rollup_vite.md\":\"d55d8321\",\"front_basic_递归与堆栈.md\":\"f1896905\",\"front_frame_vue_vue中封装v-charts 3d柱状图.md\":\"9f0dafaa\",\"library_reading_windows10 软件安装及环境配置.md\":\"c5988db3\",\"library_reading_英语训练计划.md\":\"9074c6ce\",\"library_reading_铲屎官常用英文单词.md\":\"76d5ab65\",\"front_basic_逻辑判断优化.md\":\"70deb199\",\"library_reading_一二线城市互联网公司名单.md\":\"096b9450\",\"front_node_express 教程丨阿西河.md\":\"4ea0f2bc\",\"library_reading_中级前端开发技术要求.md\":\"82a1c211\",\"front_frame_vue_vue使用过的自定义指令.md\":\"024efa72\",\"front_basic_手写代码系列_常见排序.md\":\"a58c761a\",\"library_reading_基于vscode结合vetur_eslint_prettier统一vue代码风格.md\":\"cfceafa5\",\"front_basic_英语单词.md\":\"478019b2\",\"front_basic_手写代码系列_js snippets.md\":\"e7e1d37f\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zn-CN\",\"dir\":\"ltr\",\"title\":\"Cain\",\"titleTemplate\":\"keep in mind\",\"description\":\"记录一切的地方\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"Go home\",\"logo\":\"/gezi.svg\",\"aside\":\"left\",\"outline\":\"deep\",\"nav\":[{\"text\":\"Work\",\"items\":[{\"text\":\"HTML/CSS/JS/TS\",\"link\":\"/front/basic/\"},{\"text\":\"工程化\",\"link\":\"/front/engineering/\"},{\"text\":\"Vue/React\",\"link\":\"/front/frame/\"},{\"text\":\"Node\",\"link\":\"/front/node/\"},{\"text\":\"Electron/Other\",\"link\":\"/tech/otherside/\"},{\"text\":\"算法\",\"link\":\"/tech/arithmetic/\"},{\"text\":\"设计模式\",\"link\":\"/tech/designpattern/\"}]},{\"text\":\"Life\",\"items\":[{\"text\":\"看看书\",\"link\":\"/library/reading/\"},{\"text\":\"拍照片\",\"link\":\"/library/photos/\"},{\"text\":\"录视频\",\"link\":\"/library/videos/\"}]},{\"text\":\"FindMe\",\"items\":[{\"text\":\"关于\",\"link\":\"/about/\"},{\"text\":\"TODO 指向其它\",\"link\":\"/about/Todo\"}]}],\"sidebar\":{\"/basic/\":[{\"text\":\"HTML\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"CHTML&&CSS面试问题\",\"link\":\"/front/basic/HTML&CSS/HTML&&CSS面试问题\"},{\"text\":\"HTML&CSS查缺知识点\",\"link\":\"/front/basic/HTML&CSS/HTML&CSS查缺知识点\"}]},{\"text\":\"CSS\",\"items\":[{\"text\":\"CSS-Snippets\",\"link\":\"/front/basic/HTML&CSS/CSS-Snippets\"}]},{\"text\":\"JS\",\"items\":[{\"text\":\"JavaScript语言基础上\",\"link\":\"/front/basic/01 JavaScript语言基础上\"},{\"text\":\"正则表达式简要\",\"link\":\"/front/basic/04 正则表达式简要\"},{\"text\":\"JavaScript语言零碎\",\"link\":\"/front/basic/05 JavaScript语言零碎\"},{\"text\":\"递归与堆栈\",\"link\":\"/front/basic/递归与堆栈\"},{\"text\":\"二维码识别\",\"link\":\"/front/basic/二维码识别\"},{\"text\":\"跨域请求CORS\",\"link\":\"/front/basic/跨域请求CORS\"},{\"text\":\"历史开发报错收集\",\"link\":\"/front/basic/历史开发报错收集\"},{\"text\":\"逻辑判断优化\",\"link\":\"/front/basic/逻辑判断优化\"},{\"text\":\"英语单词\",\"link\":\"/front/basic/英语单词\"},{\"text\":\"el-table使用技巧\",\"link\":\"/front/basic/el-table使用技巧\"},{\"text\":\"element-resize-detector监听页面元素\",\"link\":\"/front/basic/element-resize-detector监听页面元素\"},{\"text\":\"JavaScript面试问题\",\"link\":\"/front/basic/JavaScript面试问题\"},{\"text\":\"JQuery\",\"link\":\"/front/basic/JQuery\"},{\"text\":\"JS AJAX\",\"link\":\"/front/basic/JS AJAX\"},{\"text\":\"JSP\",\"link\":\"/front/basic/JSP\"},{\"text\":\"历史开发报错收集\",\"link\":\"/front/basic/历史开发报错收集\"}]},{\"text\":\"手写代码\",\"items\":[{\"text\":\"常见排序\",\"link\":\"/front/basic/手写代码系列/常见排序\"},{\"text\":\"华为机试\",\"link\":\"/front/basic/手写代码系列/华为机试\"},{\"text\":\"数组去重\",\"link\":\"/front/basic/手写代码系列/数组去重\"},{\"text\":\"在页面上签名保存\",\"link\":\"/front/basic/手写代码系列/在页面上签名保存\"},{\"text\":\"Axios与http请求封装\",\"link\":\"/front/basic/手写代码系列/Axios与http请求封装\"},{\"text\":\"Cookie与Storage实现验证登录\",\"link\":\"/front/basic/手写代码系列/Cookie与Storage实现验证登录\"},{\"text\":\"JS Snippets\",\"link\":\"/front/basic/手写代码系列/JS Snippets\"}]},{\"text\":\"TS\",\"items\":[{\"text\":\"TypeScript\",\"link\":\"/front/basic/TypeScript/TypeScript尝试入门\"}]}],\"/engineering/\":[{\"text\":\"简要约定式提交\",\"link\":\"/front/engineering/简要约定式提交\"},{\"text\":\"开发规范\",\"link\":\"/front/engineering/开发规范\"},{\"text\":\"前端开发路径\",\"link\":\"/front/engineering/前端开发路径\"},{\"text\":\"性能优化\",\"link\":\"/front/engineering/性能优化\"},{\"text\":\"CSS 实现字体发光效果\",\"link\":\"/front/engineering/CSS 实现字体发光效果\"},{\"text\":\"购买服务器到项目部署\",\"link\":\"/front/engineering/goumai\"},{\"text\":\"pnpm 常用命令\",\"link\":\"/front/engineering/pnpm 常用命令\"},{\"text\":\"Webpack&Rollup&Vite\",\"link\":\"/front/engineering/Webpack&Rollup&Vite\"}],\"/frame/\":[{\"text\":\"Vue\",\"items\":[{\"text\":\"打印属性及方法\",\"link\":\"/front/frame/vue/打印属性及方法\"},{\"text\":\"Echarts-封装3D柱状图\",\"link\":\"/front/frame/vue/Echarts-封装3D柱状图\"},{\"text\":\"Three.js入门\",\"link\":\"/front/frame/vue/Three.js入门\"},{\"text\":\"Uni-app请求封装与拦截\",\"link\":\"/front/frame/vue/Uni-app请求封装与拦截\"},{\"text\":\"vue-element-admin框架学习\",\"link\":\"/front/frame/vue/vue-element-admin框架学习\"},{\"text\":\"Vue使用过的自定义指令\",\"link\":\"/front/frame/vue/Vue使用过的自定义指令\"},{\"text\":\"Vue中封装Echarts柱形图\",\"link\":\"/front/frame/vue/Vue中封装Echarts柱形图\"},{\"text\":\"Vue中封装V-Charts 3D柱状图\",\"link\":\"/front/frame/vue/Vue中封装V-Charts 3D柱状图\"},{\"text\":\"vue中祖孙组件通信方法\",\"link\":\"/front/frame/vue/vue中祖孙组件通信方法\"}]},{\"text\":\"React\",\"link\":\"front/frame/react/一些React技巧\"}],\"/node/\":[{\"text\":\"Node基础\",\"items\":[{\"text\":\"Express 教程丨阿西河\",\"link\":\"/front/node/Express 教程丨阿西河\"},{\"text\":\"Express\",\"link\":\"/front/node/Express\"}]}],\"/otherside/\":[{\"text\":\"其它\",\"items\":[{\"text\":\"Electron学习笔记\",\"link\":\"/tech/otherside/Electron学习笔记\"}]},{\"text\":\"python\",\"link\":\"/tech/otherside/python\"}],\"/arithmetic/\":[{\"text\":\"LeeCode\",\"items\":[{\"text\":\"刷题\",\"link\":\"/tech/arithmetic/LeetCode/刷题\"}]},{\"text\":\"抽稀算法\",\"link\":\"/tech/arithmetic/LeetCode/抽稀算法\"}],\"/designpattern/\":[{\"text\":\"创建型设计模式\",\"items\":[{\"text\":\"🏠简单工厂模式（Simple Factory）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"🏭工厂方法模式（Factory Method）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"🔨抽象工厂模式（Abstract Factory）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"👷建造者模式\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"🐑原型模式（Prototype）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"💍单例模式（Singleton）\",\"link\":\"/tech/designpattern/index\"}]},{\"text\":\"结构型设计模式\",\"items\":[{\"text\":\"🔌适配器模式（Adapter）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"🚡桥梁模式（Bridge）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"🌿组合模式（Composite）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"☕装饰模式（Decorator）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"📦门面模式（Facade））\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"🍃享元模式（Flyweight）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"🎱代理模式（Proxy）\",\"link\":\"/tech/designpattern/index\"}]},{\"text\":\"行为型设计模式\",\"items\":[{\"text\":\"🔗责任链模式（Chain Of Responsibilities）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"👮命令行模式（Command）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"➿迭代器模式（Iterator）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"👽中介者模式（Mediator）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"💾备忘录模式（Memento）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"😎观察者模式（Observer）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"🏃访问者模式（Visitor）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"💡策略模式（Strategy）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"💢状态模式（State）\",\"link\":\"/tech/designpattern/index\"},{\"text\":\"📒模板方法模式（Template Method）\",\"link\":\"/tech/designpattern/index\"}]}],\"/reading/\":[{\"text\":\"reading\",\"link\":\"/front/library/reading\"}],\"/photos/\":[{\"text\":\"photos\",\"link\":\"/front/library/photos\"}],\"/videos/\":[{\"text\":\"videos\",\"link\":\"/front/library/videos\"}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/EvilIrving\",\"ariaLabel\":\"cool link\"},{\"icon\":\"github\",\"link\":\"http://yomuki.com/\"}],\"lastUpdated\":{\"text\":\"Updated at\",\"formatOptions\":{\"dateStyle\":\"full\",\"timeStyle\":\"medium\"}},\"docFooter\":{\"prev\":\"prev\",\"next\":\"next\"},\"returnToTopLabel\":\"back top\",\"externalLinkIcon\":true,\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>